System.register(["jimu-core","jimu-arcgis","jimu-ui","jimu-theme"],(function(e,r){var t={},n={},o={},a={};return{setters:[function(e){t.React=e.React,t.ReactRedux=e.ReactRedux,t.css=e.css,t.hooks=e.hooks,t.jsx=e.jsx},function(e){n.JimuMapViewComponent=e.JimuMapViewComponent,n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){o.Alert=e.Alert,o.Button=e.Button,o.Dropdown=e.Dropdown,o.DropdownButton=e.DropdownButton,o.DropdownItem=e.DropdownItem,o.DropdownMenu=e.DropdownMenu,o.Label=e.Label,o.Loading=e.Loading,o.SVG=e.SVG,o.Typography=e.Typography},function(e){a.useTheme=e.useTheme}],execute:function(){e((()=>{var e={655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},1888:e=>{"use strict";e.exports=a},2686:e=>{"use strict";e.exports=n},4058:(e,r,t)=>{"use strict";t.d(r,{createDefaultWidgetState:()=>s,searchActions:()=>i});var n=t(7390),o=t.n(n),a=t(5829);const s=e=>o()({results:[],activeSourceIndex:0,isSearching:!1,lastSearchTerm:"",errorMessage:null,coordinateResult:null,isCoordinateInput:!1,...e}),i=(o()({byId:{}}),{setResults:(e,r)=>({type:a.xJ.SetResults,results:Array.isArray(e)?e:[],widgetId:r}),clearResults:e=>({type:a.xJ.ClearResults,widgetId:e}),setActiveSource:(e,r)=>({type:a.xJ.SetActiveSource,index:"number"==typeof e&&Number.isFinite(e)?Math.max(0,Math.floor(e)):0,widgetId:r}),setSearching:(e,r)=>({type:a.xJ.SetSearching,value:Boolean(e),widgetId:r}),setLastSearchTerm:(e,r)=>({type:a.xJ.SetLastSearchTerm,value:"string"==typeof e?e:"",widgetId:r}),setError:(e,r)=>({type:a.xJ.SetError,message:null===e||"string"==typeof e?e:String(e),widgetId:r}),setCoordinateInput:(e,r)=>({type:a.xJ.SetCoordinateInput,isCoordinate:Boolean(e),widgetId:r}),setCoordinateResult:(e,r)=>{let t=null;if(e&&"object"==typeof e)try{const n="string"==typeof e.projectionId?e.projectionId:"",o="number"==typeof e.easting&&Number.isFinite(e.easting)?e.easting:0,s="number"==typeof e.northing&&Number.isFinite(e.northing)?e.northing:0,i="number"==typeof e.confidence&&Number.isFinite(e.confidence)?e.confidence:0;if(!n)return{type:a.xJ.SetCoordinateResult,result:null,widgetId:r};let c=null;if(e.mapPoint&&"object"==typeof e.mapPoint&&"number"==typeof e.mapPoint.x&&"number"==typeof e.mapPoint.y&&e.mapPoint.spatialReference&&"object"==typeof e.mapPoint.spatialReference){const r=e.mapPoint.spatialReference,t="number"==typeof r.wkid&&Number.isFinite(r.wkid)&&r.wkid>0,n="string"==typeof r.wkt&&r.wkt.trim().length>0;t||n?c={x:e.mapPoint.x,y:e.mapPoint.y,spatialReference:t?{wkid:r.wkid}:{wkt:r.wkt}}:console.log("Search widget: invalid spatial reference in coordinate result")}t={projectionId:n,easting:o,northing:s,warnings:Array.isArray(e.warnings)?e.warnings.filter((e=>"string"==typeof e)):[],confidence:i,format:e.format??a.Mc.Unknown,alternativeProjectionIds:Array.isArray(e.alternativeProjectionIds)?e.alternativeProjectionIds.filter((e=>"string"==typeof e)):[],mapPoint:c}}catch(e){console.log("Search widget: invalid coordinate result data",e),t=null}return{type:a.xJ.SetCoordinateResult,result:t,widgetId:r}},clearCoordinateResult:e=>({type:a.xJ.ClearCoordinateResult,widgetId:e})})},4321:e=>{"use strict";e.exports=o},5829:(e,r,t)=>{"use strict";var n,o,a,s,i;t.d(r,{Mc:()=>a,RB:()=>s,RV:()=>i,SK:()=>n,xJ:()=>o}),function(e){e.Locator="locator",e.Layer="layer"}(n||(n={})),function(e){e.SetResults="search/setResults",e.ClearResults="search/clearResults",e.SetActiveSource="search/setActiveSource",e.SetSearching="search/setSearching",e.SetLastSearchTerm="search/setLastSearchTerm",e.SetError="search/setError",e.SetCoordinateInput="search/setCoordinateInput",e.SetCoordinateResult="search/setCoordinateResult",e.ClearCoordinateResult="search/clearCoordinateResult"}(o||(o={})),function(e){e.SpaceSeparated="space",e.CommaSeparated="comma",e.Labeled="labeled",e.Unknown="unknown"}(a||(a={})),function(e){e.Auto="auto",e.Tm="tm",e.Zone="zone"}(s||(s={})),function(e){e.Default="default",e.Linear="linear"}(i||(i={}))},7390:(e,r,t)=>{var n;!function(){"use strict";var o=function e(r){var t,n="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element"),o={use_static:!1};function a(e){var r=Object.getPrototypeOf(e);return r?Object.create(r):{}}function s(e,r,t){Object.defineProperty(e,r,{enumerable:!1,configurable:!1,writable:!1,value:t})}"object"!=typeof(t=r)||Array.isArray(t)||null===t||void 0!==r.use_static&&(o.use_static=Boolean(r.use_static));var i="__immutable_invariants_hold";function c(e){return"object"!=typeof e||(null===e||Boolean(Object.getOwnPropertyDescriptor(e,i)))}function l(e,r){return e===r||e!=e&&r!=r}function u(e){return!(null===e||"object"!=typeof e||Array.isArray(e)||e instanceof Date)}var d=["setPrototypeOf"],p=(d.concat(["push","pop","sort","splice","shift","unshift","reverse"]),["keys"].concat(["map","filter","slice","concat","reduce","reduceRight"]));function h(e){this.name="MyError",this.message=e,this.stack=(new Error).stack}function f(e,r){return s(e,i,!0),e}function g(e,r){var t=e[r];s(e,r,(function(){return U(t.apply(e,arguments))}))}function m(e,r,t){var n=t&&t.deep;if(e in this&&(n&&this[e]!==r&&u(r)&&u(this[e])&&(r=U.merge(this[e],r,{deep:!0,mode:"replace"})),l(this[e],r)))return this;var o=x.call(this);return o[e]=U(r),b(o)}d.concat(["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear"]),h.prototype=new Error,h.prototype.constructor=Error;var y=U([]);function S(e,r,t){var n=e[0];if(1===e.length)return m.call(this,n,r,t);var o,a=e.slice(1),s=this[n];if("object"==typeof s&&null!==s)o=U.setIn(s,a,r);else{var i=a[0];o=""!==i&&isFinite(i)?S.call(y,a,r):F.call(P,a,r)}if(n in this&&s===o)return this;var c=x.call(this);return c[n]=o,b(c)}function b(e){for(var r in p){if(p.hasOwnProperty(r))g(e,p[r])}o.use_static||(s(e,"flatMap",w),s(e,"asObject",k),s(e,"asMutable",x),s(e,"set",m),s(e,"setIn",S),s(e,"update",O),s(e,"updateIn",_),s(e,"getIn",D));for(var t=0,n=e.length;t<n;t++)e[t]=U(e[t]);return f(e)}function v(){return new Date(this.getTime())}function w(e){if(0===arguments.length)return this;var r,t=[],n=this.length;for(r=0;r<n;r++){var o=e(this[r],r,this);Array.isArray(o)?t.push.apply(t,o):t.push(o)}return b(t)}function E(e){if(void 0===e&&0===arguments.length)return this;if("function"!=typeof e){var r=Array.isArray(e)?e.slice():Array.prototype.slice.call(arguments);r.forEach((function(e,r,t){"number"==typeof e&&(t[r]=e.toString())})),e=function(e,t){return-1!==r.indexOf(t)}}var t=a(this);for(var n in this)this.hasOwnProperty(n)&&!1===e(this[n],n)&&(t[n]=this[n]);return V(t)}function x(e){var r,t,n=[];if(e&&e.deep)for(r=0,t=this.length;r<t;r++)n.push(C(this[r]));else for(r=0,t=this.length;r<t;r++)n.push(this[r]);return n}function k(e){"function"!=typeof e&&(e=function(e){return e});var r,t={},n=this.length;for(r=0;r<n;r++){var o=e(this[r],r,this),a=o[0],s=o[1];t[a]=s}return V(t)}function C(e){return!e||"object"!=typeof e||!Object.getOwnPropertyDescriptor(e,i)||e instanceof Date?e:U.asMutable(e,{deep:!0})}function j(e,r){for(var t in e)Object.getOwnPropertyDescriptor(e,t)&&(r[t]=e[t]);return r}function I(e,r){if(0===arguments.length)return this;if(null===e||"object"!=typeof e)throw new TypeError("Immutable#merge can only be invoked with objects or arrays, not "+JSON.stringify(e));var t,n,o=Array.isArray(e),s=r&&r.deep,i=r&&r.mode||"merge",c=r&&r.merger;function d(e,n,o){var i,d=U(n[o]),p=c&&c(e[o],d,r),h=e[o];void 0===t&&void 0===p&&e.hasOwnProperty(o)&&l(d,h)||(l(h,i=void 0!==p?p:s&&u(h)&&u(d)?U.merge(h,d,r):d)&&e.hasOwnProperty(o)||(void 0===t&&(t=j(e,a(e))),t[o]=i))}if(o)for(var p=0,h=e.length;p<h;p++){var f=e[p];for(n in f)f.hasOwnProperty(n)&&d(void 0!==t?t:this,f,n)}else{for(n in e)Object.getOwnPropertyDescriptor(e,n)&&d(this,e,n);"replace"===i&&function(e,r){for(var n in e)r.hasOwnProperty(n)||(void 0===t&&(t=j(e,a(e))),delete t[n])}(this,e)}return void 0===t?this:V(t)}function M(e,r){var t=r&&r.deep;if(0===arguments.length)return this;if(null===e||"object"!=typeof e)throw new TypeError("Immutable#replace can only be invoked with objects or arrays, not "+JSON.stringify(e));return U.merge(this,e,{deep:t,mode:"replace"})}var R,A,L,P=U({});function F(e,r,t){if(!Array.isArray(e)||0===e.length)throw new TypeError('The first argument to Immutable#setIn must be an array containing at least one "key" string.');var n=e[0];if(1===e.length)return T.call(this,n,r,t);var o,s=e.slice(1),i=this[n];if(o=this.hasOwnProperty(n)&&"object"==typeof i&&null!==i?U.setIn(i,s,r):F.call(P,s,r),this.hasOwnProperty(n)&&i===o)return this;var c=j(this,a(this));return c[n]=o,V(c)}function T(e,r,t){var n=t&&t.deep;if(this.hasOwnProperty(e)&&(n&&this[e]!==r&&u(r)&&u(this[e])&&(r=U.merge(this[e],r,{deep:!0,mode:"replace"})),l(this[e],r)))return this;var o=j(this,a(this));return o[e]=U(r),V(o)}function O(e,r){var t=Array.prototype.slice.call(arguments,2),n=this[e];return U.set(this,e,r.apply(n,[n].concat(t)))}function N(e,r){for(var t=0,n=r.length;null!=e&&t<n;t++)e=e[r[t]];return t&&t==n?e:void 0}function _(e,r){var t=Array.prototype.slice.call(arguments,2),n=N(this,e);return U.setIn(this,e,r.apply(n,[n].concat(t)))}function D(e,r){var t=N(this,e);return void 0===t?r:t}function B(e){var r,t=a(this);if(e&&e.deep)for(r in this)this.hasOwnProperty(r)&&(t[r]=C(this[r]));else for(r in this)this.hasOwnProperty(r)&&(t[r]=this[r]);return t}function W(){return{}}function V(e){return o.use_static||(s(e,"merge",I),s(e,"replace",M),s(e,"without",E),s(e,"asMutable",B),s(e,"set",T),s(e,"setIn",F),s(e,"update",O),s(e,"updateIn",_),s(e,"getIn",D)),f(e)}function U(e,r,t){if(c(e)||function(e){return"object"==typeof e&&null!==e&&(60103===e.$$typeof||e.$$typeof===n)}(e)||function(e){return"undefined"!=typeof File&&e instanceof File}(e)||function(e){return"undefined"!=typeof Blob&&e instanceof Blob}(e)||function(e){return e instanceof Error}(e))return e;if(function(e){return"object"==typeof e&&"function"==typeof e.then}(e))return e.then(U);if(Array.isArray(e))return b(e.slice());if(e instanceof Date)return a=new Date(e.getTime()),o.use_static||s(a,"asMutable",v),f(a);var a,i=r&&r.prototype,l=(i&&i!==Object.prototype?function(){return Object.create(i)}:W)();for(var u in e)Object.getOwnPropertyDescriptor(e,u)&&(l[u]=U(e[u],void 0,t));return V(l)}function z(e){return function(){var r=[].slice.call(arguments),t=r.shift();return e.apply(t,r)}}function $(e,r){return function(){var t=[].slice.call(arguments),n=t.shift();return Array.isArray(n)?r.apply(n,t):e.apply(n,t)}}return U.from=U,U.isImmutable=c,U.ImmutableError=h,U.merge=z(I),U.replace=z(M),U.without=z(E),U.asMutable=(R=B,A=x,L=v,function(){var e=[].slice.call(arguments),r=e.shift();return Array.isArray(r)?A.apply(r,e):r instanceof Date?L.apply(r,e):R.apply(r,e)}),U.set=$(T,m),U.setIn=$(F,S),U.update=z(O),U.updateIn=z(_),U.getIn=z(D),U.flatMap=z(w),U.asObject=z(k),o.use_static||(U.static=e({use_static:!0})),Object.freeze(U),U}();void 0===(n=function(){return o}.call(r,t,r,e))||(e.exports=n)}()},9244:e=>{"use strict";e.exports=t}},r={};function s(t){var n=r[t];if(void 0!==n)return n.exports;var o=r[t]={exports:{}};return e[t](o,o.exports,s),o.exports}s.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return s.d(r,{a:r}),r},s.d=(e,r)=>{for(var t in r)s.o(r,t)&&!s.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},s.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var i={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(i),s.d(i,{__set_webpack_public_path__:()=>ve,default:()=>be});var e=s(9244),r=s(2686),t=s(4321),n=s(655),o=s.n(n),a=s(5829);const c="Find address or place",l=["esri/widgets/Search","esri/widgets/Search/SearchViewModel","esri/widgets/Search/LocatorSearchSource","esri/widgets/Search/LayerSearchSource","esri/core/reactiveUtils","esri/core/promiseUtils","esri/Graphic","esri/layers/GraphicsLayer","esri/layers/FeatureLayer","esri/symbols/SimpleMarkerSymbol","esri/symbols/PictureMarkerSymbol","esri/rest/locator","esri/geometry/Point","esri/geometry/SpatialReference","esri/geometry/projection"],u={id:"default-locator",type:a.SK.Locator,name:"ArcGIS World Geocoding Service",placeholder:c,url:"https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",maxSuggestions:6},d=a.RB.Auto,p=a.RV.Default,h=/[-+]?\d[\d\s.,]*/g,f=/([ENen])\s*[:=]?\s*([-+]?\d[\d\s.,]*)/g,g=/\s+/g,m=/<[^>]*>/g,y=.001;if(!Number.isFinite(y))throw new Error("PRECISION_LIMITER must be a positive finite number");const S=3e4,b=8e5,v=59e5,w=78e5,E={eMin:5e4,eMax:25e4,nMin:61e5,nMax:77e5},x={id:"sweref99-tm",epsg:3006,code:"EPSG:3006",name:"SWEREF 99 TM",shortName:"SWEREF 99 TM",type:"tm",centralMeridian:15,scaleFactor:.9996,falseEasting:5e5,falseNorthing:0,bounds:{eMin:3e5,eMax:7e5,nMin:61e5,nMax:77e5}},k=[{zoneId:"12 00",name:"SWEREF 99 12 00",epsg:3007,centralMeridian:12},{zoneId:"13 30",name:"SWEREF 99 13 30",epsg:3008,centralMeridian:13.5},{zoneId:"15 00",name:"SWEREF 99 15 00",epsg:3009,centralMeridian:15},{zoneId:"16 30",name:"SWEREF 99 16 30",epsg:3010,centralMeridian:16.5},{zoneId:"18 00",name:"SWEREF 99 18 00",epsg:3011,centralMeridian:18},{zoneId:"14 15",name:"SWEREF 99 14 15",epsg:3012,centralMeridian:14.25},{zoneId:"15 45",name:"SWEREF 99 15 45",epsg:3013,centralMeridian:15.75},{zoneId:"17 15",name:"SWEREF 99 17 15",epsg:3014,centralMeridian:17.25},{zoneId:"18 45",name:"SWEREF 99 18 45",epsg:3015,centralMeridian:18.75},{zoneId:"20 15",name:"SWEREF 99 20 15",epsg:3016,centralMeridian:20.25},{zoneId:"21 45",name:"SWEREF 99 21 45",epsg:3017,centralMeridian:21.75},{zoneId:"23 15",name:"SWEREF 99 23 15",epsg:3018,centralMeridian:23.25}].map((e=>({id:`sweref99-${e.zoneId.replace(/\s+/g,"").toLowerCase()}`,epsg:e.epsg,code:`EPSG:${e.epsg}`,name:e.name,shortName:e.name,type:"zone",zoneId:e.zoneId,centralMeridian:e.centralMeridian,scaleFactor:1,falseEasting:15e4,falseNorthing:0,bounds:E}))),C=[x,...k],j={};for(const e of C)j[e.epsg]=e;const I={};for(const e of k){I[Math.round(100*e.centralMeridian)/100]=e}Object.freeze(j),Object.freeze(I);var M=s(1888);const R=(r,t,n)=>{const o=`${n?.(1)} ${n?.(1.5)}`,a=(s=t?.label1,{font:`${s?.fontWeight?.toString()??""} ${s?.fontSize??""} ${s?.fontFamily??""}`.trim()});var s;return{actions:(0,e.css)({flex:"0 0 auto"}),sourceSelector:(0,e.css)({flex:"0 0 auto"}),resultsList:(0,e.css)({display:"flex",flex:"1 1 auto",flexDirection:"column",position:"absolute",inset:"100% 0 auto 0",marginBlockStart:n?.(1),background:r?.surface?.paper,overflow:"hidden",zIndex:2}),resultItem:(0,e.css)({display:"flex",flex:"0 0 auto",alignItems:"center",justifyContent:"space-between",...a,padding:o,cursor:"pointer","&:focus-visible":{outline:"none"}}),resultStatus:(0,e.css)({flex:"0 0 auto",padding:o}),coordinateBadge:(0,e.css)({display:"inline-flex",alignItems:"center",marginBlockEnd:n?.(1)}),coordinateDetails:(0,e.css)({display:"flex",flex:"1 1 auto",flexDirection:"column",...a,marginBlockStart:n?.(1),gap:n?.(.5)}),coordinateLabel:(0,e.css)({...a}),coordinateValue:(0,e.css)({}),coordinateWarning:(0,e.css)({display:"flex",flex:"1 1 auto",alignItems:"center",gap:n?.(.5)}),coordinateLoading:(0,e.css)({display:"flex",flex:"1 1 auto",alignItems:"center",gap:n?.(.5)})}},A=(r,t=a.RV.Default)=>{const n=r.sys?.color,o=r.sys?.typography,s=r.sys?.spacing;return t===a.RV.Linear?((r,t,n,o)=>({...R(t,n,o),container:(0,e.css)({display:"flex",background:"transparent"}),controls:(0,e.css)({display:"flex",alignItems:"center",borderBottom:`1px solid ${r?.ref?.palette?.neutral?.[500]}`,width:"100%"}),inputArea:(0,e.css)({flex:"1 1 auto",minWidth:0,".esri-widget, .esri-input, .esri-select, .esri-search, .esri-search__input, .esri-search__input-container, .esri-search .esri-search__container > .esri-widget--button, .esri-search__input-container .esri-search__clear-button":{background:"transparent !important"},".esri-input, .esri-select, .esri-search .esri-search__container > .esri-widget--button":{border:"transparent !important"},".esri-search":{width:"100% !important"},".esri-search__input-container":{position:"relative"},".esri-search__input-container .esri-search__clear-button":{right:"0 !important"}})}))(r,n,o,s):((r,t,n)=>({...R(r,t,n),container:(0,e.css)({display:"flex"}),controls:(0,e.css)({display:"flex",alignItems:"center",width:"100%",".esri-widget":{backgroundColor:"transparent !important"}}),inputArea:(0,e.css)({flex:"1 1 auto",minWidth:0,".esri-search":{width:"100% !important"},".esri-search__input-container":{position:"relative"},".esri-search .esri-search__container > .esri-widget--button":{background:r?.surface?.paperHint,color:r?.surface?.background},".esri-search__input-container .esri-search__clear-button":{right:"0 !important"}})}))(n,o,s)};var L=s(4058);const P=e=>"point"===e?.type?e:null,F=e=>{if(!e)return"";return Array.from(e).filter((e=>{const r=e.charCodeAt(0);return r>=32&&127!==r})).join("").replace(/\s+/g," ").replace(/[<>]/g,"").trim().slice(0,256)},T=e=>"extent"===e?.type?e:null,O=(e,r)=>{const t=e,n=t.graphic??e.feature??null,o=P(t.location??null)??P(n?.geometry??null),a=T(t.extent??null)??T(n?.geometry?.extent??null)??null,s=n?.attributes&&"object"==typeof n.attributes?{...n.attributes}:void 0,i=s?.Match_addr,c="string"==typeof i?i:"",l=e?.name??"";return{sourceIndex:r,name:l,text:l||c,feature:n,extent:a,location:o,attributes:s}},N=(e,r)=>{const{LocatorSearchSource:t}=e,n={name:r.name,placeholder:r.placeholder,url:r.url,apiKey:r.apiKey,maxResults:r.maxSuggestions,maxSuggestions:r.maxSuggestions,suggestionsEnabled:!0,minSuggestCharacters:3};if(Array.isArray(r.categories)&&r.categories.length&&(n.categories=r.categories),r.countryCode&&(n.countryCode=r.countryCode),r.locationType){const e=r.locationType.toLowerCase();"street"!==e&&"rooftop"!==e||(n.locationType=e)}return"boolean"==typeof r.withinViewEnabled&&(n.withinViewEnabled=r.withinViewEnabled),Array.isArray(r.outFields)&&r.outFields.length&&(n.outFields=r.outFields),new t(n)},_=(e,r,t)=>{const{LayerSearchSource:n,SimpleMarkerSymbol:o}=e,a={layer:r,name:t.name,placeholder:t.placeholder,displayField:t.displayField??r.displayField??void 0,outFields:["*"],searchFields:t.searchFields?.length?t.searchFields:void 0,exactMatch:Boolean(t.exactMatch),maxResults:t.maxSuggestions,maxSuggestions:t.maxSuggestions,suggestionsEnabled:!0,minSuggestCharacters:t.minSuggestCharacters??3};if(t.resultSymbol)try{a.resultSymbol=new o(t.resultSymbol)}catch(e){console.log("Search widget: failed to apply custom result symbol",e)}return new n(a)},D=e=>e?.type===a.SK.Locator,B=e=>e?.type===a.SK.Layer,W=e=>{let r=e.replace(m,"");return r=Array.from(r).filter((e=>{const r=e.charCodeAt(0);return r>=32&&r<=126||r>=160&&r<=255})).join(""),r.replace(g," ").trim()},V=e=>{if(e.replace(/[^0-9]/g,"").length>18)return null;const r=(e=>{let r=e.replace(/[\u00A0]/g," ").replace(/[^0-9\s,.-]/g,"");if(!r)return"";if(/[,.-]{2,}/.test(r))return"";if(/^[,.]+|[,.-]+$/.test(r.replace(/^-/,"")))return"";let t="";r.startsWith("-")?(t="-",r=r.slice(1)):r.startsWith("+")&&(r=r.slice(1)),r=r.replace(/[+-]/g,"");const n=e=>e&&"-"===t?`-${e}`:e,o=(e,r)=>{const t=e.replace(/[,.-]/g,""),n=r.replace(/[,.-]/g,"");return t||n?n?`${t}.${n}`:t:""},a=r.split(/\s+/).filter(Boolean);a.length>1&&a[0]&&a.slice(1).every((e=>e&&3===e.length))&&a[0].length<=3&&(r=r.replace(/\s+/g,""));const s=(r.match(/\./g)??[]).length,i=(r.match(/,/g)??[]).length;if(s+i>2)return"";if(1===i&&0===s){const e=r.split(",");return n(o(e[0],e[1]))}if(1===i&&s>=1){const e=r.lastIndexOf(",");return n(o(r.slice(0,e).replace(/\./g,""),r.slice(e+1)))}if(1===s&&i>=1){const e=r.replace(/,/g,"").split(".");return n(o(e[0],e[1]))}if(s>1&&0===i)return n(r.replace(/\./g,""));if(i>1&&0===s)return n(r.replace(/,/g,""));const c=r.lastIndexOf("."),l=r.lastIndexOf(","),u=Math.max(l,c);if(-1===u)return n(r.replace(/[,.-]/g,""));const d=r.slice(0,u),p=r.slice(u+1),h=p.length,f=/[,.-]/.test(d);return n(h>=1&&h<=6?f&&3===h?r.replace(/[,.-]/g,""):o(d,p):r.replace(/[,.-]/g,""))})(e);if(!r)return null;if(r.replace(/[^0-9]/g,"").length>15)return null;const t=Number.parseFloat(r);return Number.isNaN(t)||!Number.isFinite(t)||Math.abs(t)>1e8?null:Math.abs(t)<y?0:t},U=e=>e.match(h)??[],z=(e,r)=>{const t=Math.abs(e),n=Math.abs(r);return t<=90&&n<=180||t<=90&&n<=90},$=(e,r)=>{const t=e>=S&&e<=b,n=e>=v&&e<=w,o=r>=S&&r<=b,a=r>=v&&r<=w;return t&&!n&&a&&!o?{easting:e,northing:r}:n&&!t&&o&&!a?{easting:r,northing:e}:!t||o||a?!o||t||n?z(e,r)?null:t&&a?{easting:e,northing:r,warning:o?"coordinateWarningAmbiguousOrder":void 0}:n&&o?{easting:r,northing:e,warning:t?"coordinateWarningAmbiguousOrder":void 0}:null:{easting:r,northing:e}:{easting:e,northing:r}},J=(e,r,t,n,o)=>z(e,r)?{success:!1,error:"coordinateErrorNotSweref"}:G(e,r)?{success:!0,easting:e,northing:r,format:t,sanitized:n,warning:o}:{success:!1,error:"coordinateErrorOutOfRange"},G=(e,r)=>e>=S&&e<=b&&r>=v&&r<=w,K=e=>{if(!e)return{success:!1,error:"coordinateErrorEmpty"};const r=W(e);if(!r)return{success:!1,error:"coordinateErrorEmpty"};if(r.length>200)return{success:!1,error:"coordinateErrorTooLong"};const t=/[ENen]\s*[:=]/.test(n=r)?a.Mc.Labeled:/\d\s*,\s*\d/.test(n)?a.Mc.CommaSeparated:/\d\s+\d/.test(n)?a.Mc.SpaceSeparated:a.Mc.Unknown;var n;if(t===a.Mc.Labeled){const e=(e=>{let r=null,t=null;for(const n of e.matchAll(f)){const e=n[1].toUpperCase(),o=V(n[2]);null!==o&&("E"===e?r=o:"N"===e&&(t=o))}return{easting:r,northing:t}})(r);if(null!==e.easting&&null!==e.northing)return J(e.easting,e.northing,a.Mc.Labeled,r)}let o=U(r);if(o.length<2){const e=r.split(/\s+/).map((e=>e.replace(/^[,;]+|[,;]+$/g,""))).filter((e=>e.length>0));e.length>=2&&(o=e.slice(0,2))}if(o.length<2)return{success:!1,error:"coordinateErrorParse"};const s=o.slice(0,2).map(V),i=s[0],c=s[1];if(null===i||null===c)return{success:!1,error:"coordinateErrorParse"};const l=$(i,c);if(!l)return{success:!1,error:"coordinateErrorParse"};const{easting:u,northing:d,warning:p}=l;return J(u,d,t===a.Mc.Unknown?r.includes(",")?a.Mc.CommaSeparated:a.Mc.SpaceSeparated:t,r,p)},Z=e=>W(e).slice(0,200),H=[/\b(gata|gatan|v\xe4g|v\xe4gen|plan|torg|torget|all\xe9|all\xe9n)\b/i,/\b\d{3}\s?\d{2}\b/,/\b(stockholm|g\xf6teborg|malm\xf6|uppsala|link\xf6ping)\b/i],Y=(e,r,t)=>e>=r&&e<=t,q=(e,r,t)=>{const{eMin:n,eMax:o,nMin:a,nMax:s}=r;return"e"===t?Y(e,n,o):Y(e,a,s)},Q=(e,r)=>{if(0===e.length||!r)return e;const t=(e=>{let r=k[0],t=Number.POSITIVE_INFINITY;for(const n of k){const o=Math.abs(n.centralMeridian-e);o<t&&(r=n,t=o)}return r})(r);return[...e].sort(((e,n)=>e===t?-1:n===t?1:Math.abs(e.centralMeridian-r)-Math.abs(n.centralMeridian-r)))},X=(e,r)=>{if(!e)return[];const{bounds:t}=e,n=Math.abs(r-t.eMin)<=5e3,o=Math.abs(t.eMax-r)<=5e3;return n||o?["coordinateWarningNearBoundary"]:[]},ee=(e,r,t,n)=>({projection:e,confidence:r,alternatives:t,warnings:X(e,n)}),re=e=>{const{easting:r,northing:t}=e,n=e.preference??d??a.RB.Auto,o=(e=>{if(!e)return null;let r=null;return"number"==typeof e.longitude?r=e.longitude:"number"==typeof e.x&&4326===e.spatialReference?.wkid&&(r=e.x),null!==r&&(r<-180||r>180)?null:r})(e.mapCenter),s=Y(r,3e5,7e5),i=Y(r,5e4,25e4)?((e,r)=>k.filter((t=>q(e,t.bounds,"e")&&q(r,t.bounds,"n"))))(r,t):[];if(n===a.RB.Zone&&i.length){const e=Q(i,o);return ee(e[0],1,e.slice(1),r)}if(n===a.RB.Tm&&s)return ee(x,.9,i,r);if(1===i.length)return ee(i[0],1,[],r);if(i.length>1){const e=Q(i,o),t=null===o?.7:.85;return ee(e[0],t,e.slice(1),r)}return s?ee(x,.6,[],r):{projection:null,confidence:0,alternatives:[],warnings:["coordinateErrorNoProjection"]}},te=(e,r)=>e>=3e4&&e<=8e5&&r>=59e5&&r<=78e5,ne=e=>{const{easting:r,northing:t,projection:n}=e,o=[],a=[];if(!Number.isFinite(r)||!Number.isFinite(t))return{valid:!1,errors:["coordinateErrorInvalidNumber"],warnings:a};if(n&&!((e,r,t)=>{if(!t)return te(e,r);const{bounds:n}=t;return Y(e,n.eMin,n.eMax)&&Y(r,n.nMin,n.nMax)})(r,t,n)?o.push("coordinateErrorOutOfBounds"):te(r,t)||o.push("coordinateErrorOutOfRange"),!o.length&&n){const{bounds:e}=n,t=5e3,o=Math.abs(r-e.eMin)<=t,s=Math.abs(e.eMax-r)<=t;(o||s)&&a.push("coordinateWarningNearBoundary")}return{valid:0===o.length,errors:o,warnings:a}},oe=new WeakMap,ae=new WeakMap,se=async e=>{const{modules:r,spatialReference:t}=e,{projection:n}=r;if(!t)throw new Error("coordinateErrorNoSpatialReference");const o=(e=>{const{modules:r,projection:t,easting:n,northing:o}=e,{SpatialReference:a,Point:s}=r;if(!t?.epsg||"number"!=typeof t.epsg||t.epsg<=0)throw new Error("coordinateErrorInvalidProjection");if(!Number.isFinite(n)||!Number.isFinite(o))throw new Error("coordinateErrorInvalidCoordinates");return new s({x:n,y:o,spatialReference:new a({wkid:t.epsg})})})(e);if(o.spatialReference?.wkid===t.wkid)return o;try{await(async e=>{if(!e)throw new Error("Projection module unavailable");const r=oe.get(e);if(r)return r;if(ae.get(e)){await new Promise((e=>setTimeout(e,10)));const r=oe.get(e);if(r)return r}let t;ae.set(e,!0);const n=(async()=>{const r=new Promise(((e,r)=>{t=setTimeout((()=>{r(new Error("coordinateErrorProjectionTimeout"))}),5e3)}));try{await Promise.race([e.load().catch((e=>{throw e instanceof Error?e:new Error("string"==typeof e?e:"Projection load failed")})),r])}finally{t&&clearTimeout(t),ae.delete(e)}})();oe.set(e,n);try{await n}catch(r){throw oe.delete(e),r instanceof Error?r:new Error("coordinateErrorProjectionLoad")}})(n);const e=n.project(o,t);if(!(e=>{if(!e||"object"!=typeof e)return!1;const r=e;return"number"==typeof r.x&&"number"==typeof r.y})(e))throw new Error("coordinateErrorTransform");if(!Number.isFinite(e.x)||!Number.isFinite(e.y))throw new Error("coordinateErrorTransform");return e.spatialReference||(e.spatialReference=t),e}catch(e){throw e instanceof Error?e:new Error(null!=e?String(e):"coordinateErrorTransform")}},ie=(e,r)=>0===r?-1:Math.max(0,Math.min(e,r-1)),ce=e=>{if(!e)return!1;return Boolean(e.isTable)},le=()=>{const[t,n]=e.React.useState(null),[o,a]=e.React.useState(null),s=e.hooks.useCancelablePromiseMaker();return e.hooks.useEffectOnce((()=>{s((async()=>{const[e,t,n,o,a,s,i,c,u,d,p,h,f,g,m]=await(0,r.loadArcGISJSAPIModules)(l.slice());return{Search:e,SearchViewModel:t,LocatorSearchSource:n,LayerSearchSource:o,FeatureLayer:u,reactiveUtils:a,promiseUtils:s,Graphic:i,GraphicsLayer:c,SimpleMarkerSymbol:d,PictureMarkerSymbol:p,locator:h,Point:f,SpatialReference:g,projection:m}})()).then(n).catch((e=>{"AbortError"!==e?.name&&a(e)}))})),{modules:t,error:o}},ue=e=>{e?.destroy?.()},de=r=>{const{mapView:t,container:n,modules:o,config:a,activeSourceIndex:s,lastSearchTerm:i,zoomScale:c,onSearchStart:l,onSearchComplete:u,onResultSelect:d,onSearchClear:p,onSearchError:h,onActiveSourceChange:f,onInputChange:g}=r,m=e.React.useRef(null),y=e.React.useRef([]),S=e.React.useRef(0),b=e.hooks.useLatest(t),v=e.hooks.useLatest(o),w=e.hooks.useLatest(a),E=e.hooks.useLatest(s),x=e.hooks.useLatest(i),k=e.hooks.useLatest(c),C=e.hooks.useLatest(l),j=e.hooks.useLatest(u),I=e.hooks.useLatest(d),M=e.hooks.useLatest(p),R=e.hooks.useLatest(h),A=e.hooks.useLatest(f),L=e.hooks.useLatest(g),P=e.React.useRef(F(i??"")),T=e.React.useRef(s),W=e.hooks.useEventCallback((()=>{y.current.forEach((e=>{e.remove()})),y.current=[]})),V=e.hooks.useEventCallback((e=>{const r=v.current;if(!r?.reactiveUtils||!e?.viewModel)return[];const t=[],n=e.viewModel;return t.push(r.reactiveUtils.watch((()=>n.activeSourceIndex),(r=>{const t=e.sources?.length??0,n=ie("number"==typeof r?r:0,t);if(n<0)return;if(n===T.current)return;n!==ie(E.current??0,t)?(T.current=n,A.current?.(n)):T.current=n}))),t.push(r.reactiveUtils.watch((()=>n.searchTerm),(e=>{const r=F(e??"");r!==P.current&&(P.current=r,L.current?.(r))}))),t})),U=e.hooks.useEventCallback((e=>{W();const r=[e.on("search-start",(e=>{const r=e,t=F(r?.searchTerm??"");P.current=t,C.current?.(t)})),e.on("search-complete",(e=>{const r=e,t=(r?.results??[]).flatMap(((e,r)=>{const t=e??{},n="number"==typeof t.sourceIndex?t.sourceIndex:r;return(t.results??[]).map((e=>O(e,n)))}));j.current?.(t)})),e.on("select-result",(e=>{const r=e,t=r?.result;if(t){const e=O(t,t?.sourceIndex??0);I.current?.(e)}})),e.on("search-clear",(()=>{P.current="",L.current?.(""),M.current?.()})),e.on("search-error",(e=>{const r=e;r?.error instanceof Error&&R.current?.(r.error)}))],t=V(e);t.length&&r.push(...t),y.current=r})),z=e.hooks.useEventCallback((async(e,r)=>{if(!r)return;const t=++S.current,n=w.current,o=await(async e=>{const{configSources:r,modules:t,mapView:n}=e;if(!r?.length)return[];const o=[],a=n?.view;for(const e of r)if(D(e))o.push(N(t,e));else if(B(e)){let r=a?.map?.findLayerById(e.layerId);if(!r)try{r=new t.FeatureLayer({id:e.layerId||void 0,url:e.url,outFields:["*"]})}catch(r){console.log("Search widget: failed to instantiate FeatureLayer",e.layerId||e.url,r);continue}if(r?.when)try{await Promise.race([r.when(),new Promise(((e,r)=>{setTimeout((()=>{r(new Error("Layer load timeout"))}),1e4)}))])}catch(r){console.log("Search widget: failed to load layer",e.layerId||e.url,r);continue}if(!r||"failed"===r.loadStatus){console.log("Search widget: layer failed to load",e.layerId||e.url);continue}if(ce(r)||"feature"!==r?.type)continue;try{o.push(_(t,r,e))}catch(r){console.log("Search widget: failed to create layer source",e.layerId||e.url,r);continue}}return o})({configSources:n.searchSources,modules:r,mapView:b.current??null});if(t!==S.current)return;const a=o.length>0?ie(E.current??0,o.length):-1,s={includeDefaultSources:!1,sources:o,maxSuggestions:n.maxSuggestions,searchAllEnabled:!1,autoSelect:!1,popupEnabled:!0,locationEnabled:!1,placeholder:n.placeholder,searchTerm:n.persistLastSearch&&x.current?x.current:n.persistLastSearch?e.searchTerm:"",view:b.current?.view??e.view};o.length>0&&a>=0&&(s.activeSourceIndex=a),Object.assign(e,s)}));return e.hooks.useUpdateEffect((()=>{if(!v.current||!n)return ue(m.current),void(m.current=null);const e=new v.current.Search({container:n,popupEnabled:!0,popupOpenOnSelect:!0,maxSuggestions:w.current.maxSuggestions,locationEnabled:!1,placeholder:w.current.placeholder});if(Object.assign(e,{includeDefaultSources:!1,searchAllEnabled:!1,autoSelect:!1}),e.viewModel){const r=(e,r)=>{const t=r?.target??null,n=e??b.current?.view??null;if(!n||!t)return Promise.resolve();const o=n;if("function"!=typeof o?.goTo)return Promise.resolve();const a={animate:!0,duration:800},s=k.current??0,i=Number.isFinite(s)&&s>=1&&s<=1e9?s:null;if(null!==i&&i>0)return o.goTo({target:t,scale:i},a).catch((()=>{}));if((c=t)&&"object"==typeof c&&"extent"===c.type&&"function"==typeof t.expand)try{const e=t.expand(1.2);return o.goTo(e,a).catch((()=>{}))}catch{}var c;return o.goTo(t,a).catch((()=>{}))};e.viewModel.goToOverride=r}m.current=e,U(e);let r=!1;return(async()=>{try{await z(e,v.current)}catch(e){r||console.log("Failed to apply widget config:",e)}})(),()=>{r=!0,W(),ue(e),m.current=null}}),[o,n,t]),e.hooks.useUpdateEffect((()=>{m.current&&v.current&&z(m.current,v.current)}),[a.searchSources,a.maxSuggestions,a.placeholder,a.persistLastSearch,a.zoomScale]),e.hooks.useUpdateEffect((()=>{if(m.current){const e=m.current.sources?.length??0,r=ie(s,e);m.current.activeSourceIndex=Math.max(0,r)}T.current=s}),[s]),e.hooks.useUnmount((()=>{W(),ue(m.current),m.current=null})),m},pe=r=>{const t=(()=>{const r=e.hooks.useEventCallback((e=>Z(e??""))),t=e.hooks.useEventCallback((e=>{const t=r(e),n=K(t);return n.success?{...n,sanitized:t}:n}));return{sanitizeInput:r,parseCoordinates:t}})(),n=(r=>{const t=e.hooks.useLatest(r.mapView??null),n=e.hooks.useLatest(r.preference??d);return{detectProjection:e.hooks.useEventCallback(((e,r)=>re({easting:e,northing:r,mapCenter:t.current?.view?.center??null,preference:n.current})))}})({mapView:r.mapView,preference:r.preference}),o=(r=>{const t=e.hooks.useLatest(r.modules),n=e.hooks.useLatest(r.mapView);return{transform:e.hooks.useEventCallback((async e=>{const r=t.current,o=n.current?.view??null;if(!r)throw new Error("coordinateErrorMissingModules");if(!o)throw new Error("coordinateErrorNoMapView");const a=await se({easting:e.easting,northing:e.northing,projection:e.projection,modules:r,spatialReference:o.spatialReference??null});if(!a)throw new Error("coordinateErrorTransform");return a}))}})({modules:r.modules,mapView:r.mapView}),s=e.React.useRef(0),i=e.hooks.useLatest(r.onSuccess),c=e.hooks.useLatest(r.onError),l=e.hooks.useLatest(r.modules),u=e.React.useRef(null),p=e.hooks.useEventCallback((()=>{const e=u.current;if(e?.cancel)try{e.cancel()}catch(e){e instanceof Error&&!e.message.includes("abort")&&!e.message.includes("cancel")&&console.log("Unexpected debounce cancellation error:",e)}u.current=null})),h=e.hooks.useEventCallback((async e=>{const r=++s.current;let l=!1;const u=()=>{if(r!==s.current)throw new Error("coordinateSearchOutdated")},d=e=>{throw u(),l=!0,c.current?.(e),new Error(e)};try{const c=t.parseCoordinates(e);if(u(),!c.success||void 0===c.easting||void 0===c.northing){return d(c.error??"coordinateErrorParse")}const l=c.warning?[c.warning]:[],p=n.detectProjection(c.easting,c.northing);if(u(),!p.projection)return d("coordinateErrorNoProjection");const h=ne({easting:c.easting,northing:c.northing,projection:p.projection});if(u(),!h.valid){return d(h.errors[0]??"coordinateErrorOutOfBounds")}const f=await o.transform({easting:c.easting,northing:c.northing,projection:p.projection});u();const g={point:f,projection:p.projection,easting:c.easting,northing:c.northing,validation:h,format:c.format??a.Mc.Unknown,confidence:p.confidence,alternatives:p.alternatives,warnings:Array.from(new Set([...l,...p.warnings??[],...h.warnings]))};if(r!==s.current)throw new Error("coordinateSearchOutdated");return i.current?.(g),g}catch(e){if(e instanceof Error&&"coordinateSearchOutdated"===e.message)throw e;const t=e instanceof Error&&e.message?e.message:"coordinateErrorGeneric";throw l||r!==s.current||c.current?.(t),new Error(t)}}));e.hooks.useUpdateEffect((()=>{p();const e=l.current;return e?.promiseUtils?.debounce&&(u.current=e.promiseUtils.debounce((e=>h(e)))),()=>{p()}}),[r.modules]),e.hooks.useUnmount(p);return{searchCoordinates:e.hooks.useEventCallback((e=>{const r=u.current;return r?r(e):h(e)})),sanitizeInput:t.sanitizeInput}},he={searchPlaceholder:"Search for address or place",searchAriaLabel:"Search for place or feature",searchButton:"Search",clearSearch:"Clear search",selectSource:"Select search source",noResultsFound:"No results found",errorSearchFailed:"Search failed. Please try again.",loadingResults:"Loading results...",resultCount:"{count} results found",resultFromSource:"From {source}",searchModeLabel:"Choose search mode",modeGeocodingLabel:"Search",modeCoordinatesLabel:"Coordinates",placeholderCoordinates:"Paste SWEREF 99 coordinates (e.g. 123456 7890123)",coordinateHintUnlabeled:"Enter two coordinates separated by space or comma",coordinateHintLabeled:"Use E= and N= to specify axis order",coordinateProjectionAria:"Detected coordinate system: {projection}",coordinateEasting:"Easting",coordinateNorthing:"Northing",coordinateErrorEmpty:"Enter coordinates to search.",coordinateErrorTooLong:"Coordinate input is too long.",coordinateErrorParse:"Could not parse coordinates. Try format: E=123456 N=7890123.",coordinateErrorNotSweref:"The coordinates do not look like SWEREF 99 values.",coordinateErrorOutOfRange:"Coordinates are outside the valid SWEREF 99 range.",coordinateErrorOutOfBounds:"Coordinates are outside the detected projection bounds.",coordinateErrorInvalidNumber:"Coordinates must be numeric.",coordinateErrorNoProjection:"Could not detect a SWEREF 99 projection for these coordinates.",coordinateErrorGeneric:"Coordinate search failed. Please try again.",coordinateErrorProjectionTimeout:"Projection tools took too long to load.",coordinateErrorProjectionLoad:"Could not load projection tools.",coordinateErrorNoSpatialReference:"Map spatial reference is unavailable.",coordinateErrorTransform:"Could not transform coordinates to the map projection.",coordinateErrorMissingModules:"Coordinate tools are not ready yet.",coordinateErrorNoMapView:"The map view is unavailable.",coordinateWarningNearBoundary:"Coordinates are near the projection boundary. Verify the projection.",coordinateWarningAmbiguousOrder:"Coordinates could be interpreted multiple ways. Use E= and N= to be sure.",searchNavigationFailed:"Could not navigate to the result."},fe=new Map(C.map((e=>[e.id,e]))),ge=e=>e?fe.get(e)??null:null;function me(e){if(null==e)return null;const r=e;return"function"==typeof r.asMutable?r.asMutable({deep:!0}):e}const ye=e=>{if(!e)return!1;return Boolean(e.destroyed)},Se=e=>{const r=e?.asMutable?.({deep:!0})??{},t=Array.isArray(r.searchSources)?r.searchSources:[],n=r.placeholder??c,o=r.maxSuggestions??6,s=t.length?t.map(((e,r)=>{const t={id:e?.id??`search-source-${r}`,name:e?.name??`Source ${r+1}`,placeholder:e?.placeholder??n,maxSuggestions:e?.maxSuggestions??o};return e?.type===a.SK.Layer?{...t,type:a.SK.Layer,url:e.url??"",layerId:e.layerId??"",searchFields:e.searchFields?[...e.searchFields]:[],displayField:e.displayField,exactMatch:e.exactMatch}:{...t,type:a.SK.Locator,url:e?.type===a.SK.Locator&&e.url?e.url:u.url,apiKey:e?.type===a.SK.Locator?e.apiKey:void 0}})):[{...u}];return{placeholder:n,maxSuggestions:o,zoomScale:r.zoomScale??1e4,persistLastSearch:r.persistLastSearch??!0,searchSources:s,enableCoordinateSearch:r.enableCoordinateSearch??!0,coordinateZoomScale:"number"==typeof r.coordinateZoomScale&&r.coordinateZoomScale>0?r.coordinateZoomScale:1e4,preferredProjection:r.preferredProjection??d,showCoordinateBadge:r.showCoordinateBadge??!0,styleVariant:r.styleVariant??p}},be=n=>{const{id:s,useMapWidgetIds:i}=n,c=e.hooks.useTranslation(he),l=(r=>{const t=e.React.useRef(null);return t.current&&t.current.source===r||(t.current={source:r,value:Se(r)}),t.current.value})(n.config),u=((r=a.RV.Default)=>{const t=(0,M.useTheme)(),n=e.React.useRef(null),o=e.React.useRef(t),s=e.React.useRef(r);let i=n.current;return i&&o.current===t&&s.current===r||(i=A(t,r),n.current=i,o.current=t,s.current=r),i})(l.styleVariant??p),d=Array.isArray(i)?(()=>{for(const e of i){if("string"!=typeof e)continue;const r=e.trim();if(r)return r}return null})():null,h=e.React.useRef((0,L.createDefaultWidgetState)()),f=e.ReactRedux.useDispatch(),g=e.ReactRedux.useSelector((e=>e.searchWidgetState?.byId?.[s]??h.current)),[m,y]=e.React.useState(null),[S,b]=e.React.useState(null),[v,w]=e.React.useState(!1),[E,x]=e.React.useState(!1),[k,C]=e.React.useState(null),j=e.React.useRef([]),I=(r=>{const t=e.React.useRef(null);if(!t.current||t.current.source!==r){const e=me(r)??[];t.current={source:r,value:e}}return t.current.value})(g.results),R=(r=>{const t=e.React.useRef(null);return t.current&&t.current.source===r||(t.current={source:r,value:me(r)}),t.current.value})(g.coordinateResult),{modules:P,error:F}=le(),T=e.hooks.useEventCallback((e=>{y(e)}));e.hooks.useUpdateEffect((()=>{d||y(null)}),[d]);const O=e.hooks.useEventCallback((e=>{e!==S&&b(e)})),N=e.hooks.useEventCallback((()=>{w((e=>!e))})),_=e.hooks.useEventCallback((()=>{w(!1)})),D=e.hooks.useEventCallback((e=>{f(L.searchActions.setSearching(e,s))})),B=e.hooks.useEventCallback((e=>{f(L.searchActions.setLastSearchTerm(e,s))})),W=e.hooks.useEventCallback((()=>{j.current=[],f(L.searchActions.clearResults(s))})),J=e.hooks.useEventCallback((e=>{f(L.searchActions.setResults(e,s))})),G=e.hooks.useEventCallback((e=>{f(L.searchActions.setError(e,s))})),K=e.hooks.useEventCallback((e=>{f(L.searchActions.setActiveSource(e,s))})),Y=e.hooks.useEventCallback((e=>{f(L.searchActions.setCoordinateInput(e,s))})),q=e.hooks.useEventCallback((e=>{f(L.searchActions.setCoordinateResult(e,s))})),Q=e.hooks.useEventCallback((()=>{f(L.searchActions.clearCoordinateResult(s))})),X=e.React.useRef(null),ee=e.React.useRef(null),re=e.hooks.useLatest(P),te=e.hooks.useLatest(m),ne=e.hooks.useLatest(l.coordinateZoomScale),oe=e.hooks.useLatest(g.isCoordinateInput),ae=e.React.useRef(!1),se=e.React.useRef(""),ie=`${s}-coordinate-layer`;e.hooks.useUpdateEffect((()=>{const e=l.enableCoordinateSearch,r=m?.view,t=re.current,n=X.current,o=ee.current,a=(e,r)=>{if(!e||!r?.map)return;r.map.findLayerById(e.id)===e&&r.map.remove(e)};if(!e)return a(n,o),X.current=null,void(ee.current=null);if(!r||!t)return;let s=r.map?.findLayerById(ie);return s||(s=new t.GraphicsLayer({id:ie,listMode:"hide"}),r.map?.add(s)),X.current=s,ee.current=r,()=>{s&&r&&a(s,r),X.current===s&&(X.current=null),ee.current===r&&(ee.current=null)}}),[l.enableCoordinateSearch,m,P,ie]);const ce=e.hooks.useEventCallback((e=>{const r=re.current,t=X.current;if(r&&t)if(ye(t))X.current=null;else try{if(ye(t))return void(X.current=null);t.removeAll();const n=new r.SimpleMarkerSymbol({style:"x",color:[32,108,255,.95],size:14,outline:{color:[255,255,255,.9],width:2}});t.add(new r.Graphic({geometry:e,symbol:n}))}catch(e){X.current=null,console.log("Failed to update coordinate graphic:",e)}})),ue=e.hooks.useEventCallback((e=>{const r=te.current?.view,t=ne.current??1e4;r&&t>0&&r.goTo({target:e,scale:t},{animate:!0}).catch((()=>{}))})),fe=pe({modules:P,mapView:m,preference:l.preferredProjection,onSuccess:e=>{oe.current&&(x(!1),q((e=>({projectionId:e.projection.id,easting:e.easting,northing:e.northing,warnings:[...e.warnings??[]],confidence:e.confidence,format:e.format,alternativeProjectionIds:(e.alternatives??[]).map((e=>e.id)),mapPoint:"function"==typeof e.point?.toJSON?e.point.toJSON():null}))(e)),ce(e.point),ue(e.point),G(null))},onError:e=>{if(!oe.current)return;if(e?.startsWith("coordinateWarning"))return;x(!1);const r=c(e??"coordinateErrorGeneric"),t=r&&r!==e?r:c("coordinateErrorGeneric");r===e&&e&&"coordinateErrorGeneric"!==e&&console.log(`Missing translation for error key: ${e}`),G(t),Q(),X.current?.removeAll()}});e.hooks.useUpdateEffect((()=>{if(!l.enableCoordinateSearch)return;const e=R,r=re.current;if(!(e&&e.mapPoint&&r?.Point&&r?.SpatialReference))return void X.current?.removeAll();const t=X.current;if(t&&!ye(t))try{const n=e.mapPoint;if("number"!=typeof n.x||"number"!=typeof n.y||!Number.isFinite(n.x)||!Number.isFinite(n.y))return console.log("Search widget: invalid stored coordinate data"),void t.removeAll();if(!n.spatialReference||"object"!=typeof n.spatialReference)return console.log("Search widget: missing spatial reference in stored coordinate"),void t.removeAll();const o=n.spatialReference,a="number"==typeof o.wkid&&Number.isFinite(o.wkid)&&o.wkid>0,s="string"==typeof o.wkt&&o.wkt.trim().length>0;if(!a&&!s)return console.log("Search widget: invalid spatial reference in stored coordinate"),void t.removeAll();const i=new r.SpatialReference(a?{wkid:o.wkid}:{wkt:o.wkt}),c=new r.Point({x:n.x,y:n.y,spatialReference:i});if(!c||"number"!=typeof c.x||"number"!=typeof c.y||!Number.isFinite(c.x)||!Number.isFinite(c.y))return console.log("Search widget: failed to construct valid Point from stored data"),void t.removeAll();X.current!==t||ye(t)||ce(c)}catch(e){console.log("Search widget: failed to render stored coordinate",e),X.current===t&&t.removeAll()}else X.current=null}),[l.enableCoordinateSearch,R,re,ce]);const be=e.hooks.useEventCallback((()=>{ae.current=!1,Q(),X.current?.removeAll(),x(!1),se.current=""})),ve=e.hooks.useEventCallback((e=>{if(e){if(!re.current)return ae.current=!0,void x(!0);ae.current=!1,x(!0),Q(),fe.searchCoordinates(e).catch((e=>{e instanceof Error&&"coordinateSearchOutdated"===e.message||e instanceof Error&&e.message||console.log("Coordinate search error:",e)}))}})),we=e.hooks.useEventCallback((e=>{const r=e??"";if(B(r),!l.enableCoordinateSearch)return C(null),void(oe.current&&(Y(!1),be()));if(!r)return C(null),void(oe.current&&(Y(!1),be()));const t=(e=>{const r=Z(e);if(!r||r.length<5)return{isCoordinate:!1,confidence:"high",reason:"input_too_short"};if((e=>{const r=e.match(/[A-Za-z]+/g);return!!r&&r.some((e=>!/^[ENen]+$/.test(e)))})(r))return{isCoordinate:!1,confidence:"high",reason:"unsupported_characters"};const t=U(r);if(2!==t.length)return{isCoordinate:!1,confidence:t.length>2?"medium":"high",reason:"not_two_numbers"};const n=t.map(V);if(n.some((e=>null===e)))return{isCoordinate:!1,confidence:"high",reason:"invalid_numbers"};if(H.some((e=>e.test(r))))return{isCoordinate:!1,confidence:"high",reason:"address_pattern_detected"};const[o,a]=n,s=$(o,a);return s?{isCoordinate:!0,confidence:s.warning?"medium":"high",reason:"sweref99_range"}:z(o,a)?{isCoordinate:!0,confidence:"medium",reason:"wgs84_range"}:{isCoordinate:!1,confidence:"high",reason:"out_of_range"}})(r);C(t);const n=oe.current,o=t.isCoordinate&&"low"!==t.confidence;Y(o),o?(n||(W(),D(!1),G(null)),se.current!==r&&(se.current=r,ve(r))):n&&be()}));e.hooks.useUpdateEffect((()=>{if(!(l.enableCoordinateSearch&&g.isCoordinateInput&&P&&ae.current))return;const e=se.current;e?ve(e):ae.current=!1}),[P,l.enableCoordinateSearch,g.isCoordinateInput,ve]);const Ee=de({mapView:m,container:S,modules:P,config:l,activeSourceIndex:g.activeSourceIndex,lastSearchTerm:g.lastSearchTerm,zoomScale:l.zoomScale,onInputChange:we,onSearchStart:e=>{oe.current?D(!1):(D(!0),B(e),G(null))},onSearchComplete:e=>{if(oe.current)return void D(!1);j.current=e;const r=e.map((e=>{return{sourceIndex:(r=e).sourceIndex,name:r.name,text:r.text,location:(n=r.location,n&&"function"==typeof n.toJSON?n.toJSON():null),extent:(t=r.extent,t&&"function"==typeof t.toJSON?t.toJSON():null),attributes:r.attributes?{...r.attributes}:void 0};var r,t,n}));J(r),D(!1)},onResultSelect:e=>{B(e.text||e.name)},onSearchClear:()=>{W()},onSearchError:()=>{oe.current?D(!1):G(c("errorSearchFailed"))},onActiveSourceChange:e=>{K(e)}}),{activeSource:xe,hasMultiple:ke,changeHandler:Ce}=(r=>{const{sources:t,activeIndex:n,onChange:o}=r,a=e.hooks.useEventCallback((e=>{e>=0&&e<t.length&&o(e)}));return{activeSource:t[n]??null,hasMultiple:t.length>1,changeHandler:a}})({sources:l.searchSources,activeIndex:g.activeSourceIndex,onChange:e=>{K(e),Ee.current&&(Ee.current.activeSourceIndex=e),_()}}),je=l.enableCoordinateSearch&&g.isCoordinateInput,Ie=!P||(je?E:g.isSearching),Me=e=>{if(!e)return c("coordinateErrorNoProjection");const r=`crs_${e.id.replace(/-/g,"_")}`,t=c(r);return t!==r?t:e.name},Re=(r,n)=>(0,e.jsx)("div",null,(0,e.jsx)(t.Label,{css:u.coordinateLabel},c(r)),(0,e.jsx)(t.Typography,{css:u.coordinateValue},(e=>new Intl.NumberFormat(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}).format(e))(n)," m")),Ae=e.hooks.useEventCallback((e=>{const r=j.current;if(!Array.isArray(r)||0===r.length)return void console.log("Search widget: no results available");if(e<0||e>=r.length)return void console.log("Search widget: invalid result index",e);const t=r[e];if(!t)return void console.log("Search widget: missing result at index",e);const n=m?.view??Ee.current?.view??null,o=(a=n,Boolean(a&&"function"==typeof a.goTo)?n:null);var a;if(!o)return void console.log("Search widget: map view not available for navigation");const s=t.extent??t.location??null;s?o.goTo(s).catch((e=>{console.log("Search widget: navigation failed",e)})):console.log("Search widget: result lacks navigable geometry")}));return(0,e.jsx)("div",{"aria-live":"polite"},(0,e.jsx)("div",{css:u.container},(0,e.jsx)("div",{css:u.controls},(0,e.jsx)("div",{css:u.inputArea,"data-loading":Ie},Ie&&(0,e.jsx)(t.Loading,null),(0,e.jsx)("div",{ref:O,"aria-label":c("searchPlaceholder")})),(0,e.jsx)("div",{css:u.actions},ke&&(0,e.jsx)(t.Dropdown,{isOpen:v,toggle:N,css:u.sourceSelector},(0,e.jsx)(t.DropdownButton,{"aria-label":c("selectSource")},(0,e.jsx)(t.Typography,null,xe?.name??c("selectSource")),(0,e.jsx)(t.SVG,{src:o()})),(0,e.jsx)(t.DropdownMenu,{role:"menu"},l.searchSources.map(((r,n)=>(0,e.jsx)(t.DropdownItem,{key:r.id??`source-${n}`,active:n===g.activeSourceIndex,onClick:()=>{Ce(n)}},r.name)))))))),(()=>{if(!(l.enableCoordinateSearch&&l.showCoordinateBadge&&g.isCoordinateInput&&R?.projectionId))return null;const r=ge(R.projectionId),n=Me(r);return(0,e.jsx)("div",{css:u.coordinateBadge,role:"status","aria-live":"polite","aria-label":c("coordinateDetected",{projection:n})},(0,e.jsx)(t.Typography,null,n),"medium"===k?.confidence&&(0,e.jsx)(t.Typography,null,c("warningLowConfidence")))})(),g.errorMessage&&(0,e.jsx)(t.Alert,{open:!0,withIcon:!0,type:"error",text:g.errorMessage}),(()=>{if(je)return E?(0,e.jsx)("div",{css:u.coordinateLoading},(0,e.jsx)(t.Loading,null),(0,e.jsx)(t.Typography,null,c("searching"))):R?(()=>{if(!R)return null;const r=ge(R.projectionId),n=Me(r);return(0,e.jsx)("div",{css:u.coordinateDetails,role:"group"},(0,e.jsx)("div",null,(0,e.jsx)(t.Label,{css:u.coordinateLabel},c("projection")),(0,e.jsx)(t.Typography,{css:u.coordinateValue},n)),Re("coordinateEasting",R.easting),Re("coordinateNorthing",R.northing),R.warnings?.map(((r,o)=>(0,e.jsx)("div",{key:`${r}-${o}`,css:u.coordinateWarning,role:"note"},(0,e.jsx)(t.Typography,null,c(r,{projection:n}))))))})():null;if(!I.length){return g.lastSearchTerm&&!g.isSearching&&!g.errorMessage?(0,e.jsx)(t.Typography,{css:u.resultStatus},c("noResultsFound")):null}return(0,e.jsx)("div",{css:u.resultsList,role:"list"},I.map(((r,n)=>(0,e.jsx)(t.Button,{key:`${r.sourceIndex}-${n}-${r.name}`,css:u.resultItem,onClick:()=>{Ae(n)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),Ae(n))},role:"listitem",type:"tertiary"},(0,e.jsx)(t.Typography,null,r.name||r.text),(0,e.jsx)(t.Typography,null,c("resultFromSource",{source:l.searchSources[r.sourceIndex]?.name??xe?.name??""}))))))})(),F&&(0,e.jsx)(t.Alert,{open:!0,withIcon:!0,type:"error",text:c("errorSearchFailed")}),d&&(0,e.jsx)(r.JimuMapViewComponent,{useMapWidgetId:d,onActiveViewChange:T}))};function ve(e){s.p=e}})(),i})())}}}));