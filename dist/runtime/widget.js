System.register(["jimu-core","jimu-arcgis","jimu-ui","jimu-theme"],(function(e,r){var t={},n={},o={},a={};return{setters:[function(e){t.React=e.React,t.ReactRedux=e.ReactRedux,t.css=e.css,t.hooks=e.hooks,t.jsx=e.jsx},function(e){n.JimuMapViewComponent=e.JimuMapViewComponent,n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){o.Alert=e.Alert,o.Button=e.Button,o.Dropdown=e.Dropdown,o.DropdownButton=e.DropdownButton,o.DropdownItem=e.DropdownItem,o.DropdownMenu=e.DropdownMenu,o.Label=e.Label,o.Loading=e.Loading,o.SVG=e.SVG,o.Typography=e.Typography},function(e){a.useTheme=e.useTheme}],execute:function(){e((()=>{var e={655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},1888:e=>{"use strict";e.exports=a},2686:e=>{"use strict";e.exports=n},4058:(e,r,t)=>{"use strict";t.d(r,{createDefaultWidgetState:()=>s,searchActions:()=>i});var n=t(7390),o=t.n(n),a=t(5829);const s=e=>o()({results:[],activeSourceIndex:0,isSearching:!1,lastSearchTerm:"",errorMessage:null,coordinateResult:null,isCoordinateInput:!1,...e}),i=(o()({byId:{}}),{setResults:(e,r)=>({type:a.xJ.SetResults,results:Array.isArray(e)?e:[],widgetId:r}),clearResults:e=>({type:a.xJ.ClearResults,widgetId:e}),setActiveSource:(e,r)=>({type:a.xJ.SetActiveSource,index:"number"==typeof e&&Number.isFinite(e)&&e>=0?e:0,widgetId:r}),setSearching:(e,r)=>({type:a.xJ.SetSearching,value:Boolean(e),widgetId:r}),setLastSearchTerm:(e,r)=>({type:a.xJ.SetLastSearchTerm,value:"string"==typeof e?e:"",widgetId:r}),setError:(e,r)=>({type:a.xJ.SetError,message:null===e||"string"==typeof e?e:String(e),widgetId:r}),setCoordinateInput:(e,r)=>({type:a.xJ.SetCoordinateInput,isCoordinate:Boolean(e),widgetId:r}),setCoordinateResult:(e,r)=>{if(!e||"object"!=typeof e)return{type:a.xJ.SetCoordinateResult,result:null,widgetId:r};const t="string"==typeof e.projectionId?e.projectionId:"";if(!t)return{type:a.xJ.SetCoordinateResult,result:null,widgetId:r};const n="number"==typeof e.easting&&Number.isFinite(e.easting)?e.easting:0,o="number"==typeof e.northing&&Number.isFinite(e.northing)?e.northing:0,s="number"==typeof e.confidence&&Number.isFinite(e.confidence)?e.confidence:0;let i=null;const c=e.mapPoint;if(c&&"object"==typeof c&&"number"==typeof c.x&&"number"==typeof c.y&&c.spatialReference&&"object"==typeof c.spatialReference){const e=c.spatialReference,r="number"==typeof e.wkid&&Number.isFinite(e.wkid)&&e.wkid>0,t="string"==typeof e.wkt&&e.wkt.trim().length>0;(r||t)&&(i={x:c.x,y:c.y,spatialReference:r?{wkid:e.wkid}:{wkt:e.wkt}})}return{type:a.xJ.SetCoordinateResult,result:{projectionId:t,easting:n,northing:o,warnings:Array.isArray(e.warnings)?e.warnings.filter((e=>"string"==typeof e)):[],confidence:s,format:e.format??a.Mc.Unknown,alternativeProjectionIds:Array.isArray(e.alternativeProjectionIds)?e.alternativeProjectionIds.filter((e=>"string"==typeof e)):[],mapPoint:i},widgetId:r}},clearCoordinateResult:e=>({type:a.xJ.ClearCoordinateResult,widgetId:e})})},4321:e=>{"use strict";e.exports=o},5829:(e,r,t)=>{"use strict";var n,o,a,s,i;t.d(r,{Mc:()=>a,RB:()=>s,RV:()=>i,SK:()=>n,xJ:()=>o}),function(e){e.Locator="locator",e.Layer="layer"}(n||(n={})),function(e){e.SetResults="search/setResults",e.ClearResults="search/clearResults",e.SetActiveSource="search/setActiveSource",e.SetSearching="search/setSearching",e.SetLastSearchTerm="search/setLastSearchTerm",e.SetError="search/setError",e.SetCoordinateInput="search/setCoordinateInput",e.SetCoordinateResult="search/setCoordinateResult",e.ClearCoordinateResult="search/clearCoordinateResult"}(o||(o={})),function(e){e.SpaceSeparated="space",e.CommaSeparated="comma",e.Labeled="labeled",e.Unknown="unknown"}(a||(a={})),function(e){e.Auto="auto",e.Tm="tm",e.Zone="zone"}(s||(s={})),function(e){e.Default="default",e.Linear="linear"}(i||(i={}))},7390:(e,r,t)=>{var n;!function(){"use strict";var o=function e(r){var t,n="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element"),o={use_static:!1};function a(e){var r=Object.getPrototypeOf(e);return r?Object.create(r):{}}function s(e,r,t){Object.defineProperty(e,r,{enumerable:!1,configurable:!1,writable:!1,value:t})}"object"!=typeof(t=r)||Array.isArray(t)||null===t||void 0!==r.use_static&&(o.use_static=Boolean(r.use_static));var i="__immutable_invariants_hold";function c(e){return"object"!=typeof e||(null===e||Boolean(Object.getOwnPropertyDescriptor(e,i)))}function l(e,r){return e===r||e!=e&&r!=r}function u(e){return!(null===e||"object"!=typeof e||Array.isArray(e)||e instanceof Date)}var d=["setPrototypeOf"],p=(d.concat(["push","pop","sort","splice","shift","unshift","reverse"]),["keys"].concat(["map","filter","slice","concat","reduce","reduceRight"]));function h(e){this.name="MyError",this.message=e,this.stack=(new Error).stack}function f(e,r){return s(e,i,!0),e}function g(e,r){var t=e[r];s(e,r,(function(){return z(t.apply(e,arguments))}))}function m(e,r,t){var n=t&&t.deep;if(e in this&&(n&&this[e]!==r&&u(r)&&u(this[e])&&(r=z.merge(this[e],r,{deep:!0,mode:"replace"})),l(this[e],r)))return this;var o=x.call(this);return o[e]=z(r),b(o)}d.concat(["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear"]),h.prototype=new Error,h.prototype.constructor=Error;var y=z([]);function S(e,r,t){var n=e[0];if(1===e.length)return m.call(this,n,r,t);var o,a=e.slice(1),s=this[n];if("object"==typeof s&&null!==s)o=z.setIn(s,a,r);else{var i=a[0];o=""!==i&&isFinite(i)?S.call(y,a,r):O.call(A,a,r)}if(n in this&&s===o)return this;var c=x.call(this);return c[n]=o,b(c)}function b(e){for(var r in p){if(p.hasOwnProperty(r))g(e,p[r])}o.use_static||(s(e,"flatMap",v),s(e,"asObject",k),s(e,"asMutable",x),s(e,"set",m),s(e,"setIn",S),s(e,"update",F),s(e,"updateIn",N),s(e,"getIn",D));for(var t=0,n=e.length;t<n;t++)e[t]=z(e[t]);return f(e)}function w(){return new Date(this.getTime())}function v(e){if(0===arguments.length)return this;var r,t=[],n=this.length;for(r=0;r<n;r++){var o=e(this[r],r,this);Array.isArray(o)?t.push.apply(t,o):t.push(o)}return b(t)}function E(e){if(void 0===e&&0===arguments.length)return this;if("function"!=typeof e){var r=Array.isArray(e)?e.slice():Array.prototype.slice.call(arguments);r.forEach((function(e,r,t){"number"==typeof e&&(t[r]=e.toString())})),e=function(e,t){return-1!==r.indexOf(t)}}var t=a(this);for(var n in this)this.hasOwnProperty(n)&&!1===e(this[n],n)&&(t[n]=this[n]);return U(t)}function x(e){var r,t,n=[];if(e&&e.deep)for(r=0,t=this.length;r<t;r++)n.push(C(this[r]));else for(r=0,t=this.length;r<t;r++)n.push(this[r]);return n}function k(e){"function"!=typeof e&&(e=function(e){return e});var r,t={},n=this.length;for(r=0;r<n;r++){var o=e(this[r],r,this),a=o[0],s=o[1];t[a]=s}return U(t)}function C(e){return!e||"object"!=typeof e||!Object.getOwnPropertyDescriptor(e,i)||e instanceof Date?e:z.asMutable(e,{deep:!0})}function I(e,r){for(var t in e)Object.getOwnPropertyDescriptor(e,t)&&(r[t]=e[t]);return r}function j(e,r){if(0===arguments.length)return this;if(null===e||"object"!=typeof e)throw new TypeError("Immutable#merge can only be invoked with objects or arrays, not "+JSON.stringify(e));var t,n,o=Array.isArray(e),s=r&&r.deep,i=r&&r.mode||"merge",c=r&&r.merger;function d(e,n,o){var i,d=z(n[o]),p=c&&c(e[o],d,r),h=e[o];void 0===t&&void 0===p&&e.hasOwnProperty(o)&&l(d,h)||(l(h,i=void 0!==p?p:s&&u(h)&&u(d)?z.merge(h,d,r):d)&&e.hasOwnProperty(o)||(void 0===t&&(t=I(e,a(e))),t[o]=i))}if(o)for(var p=0,h=e.length;p<h;p++){var f=e[p];for(n in f)f.hasOwnProperty(n)&&d(void 0!==t?t:this,f,n)}else{for(n in e)Object.getOwnPropertyDescriptor(e,n)&&d(this,e,n);"replace"===i&&function(e,r){for(var n in e)r.hasOwnProperty(n)||(void 0===t&&(t=I(e,a(e))),delete t[n])}(this,e)}return void 0===t?this:U(t)}function R(e,r){var t=r&&r.deep;if(0===arguments.length)return this;if(null===e||"object"!=typeof e)throw new TypeError("Immutable#replace can only be invoked with objects or arrays, not "+JSON.stringify(e));return z.merge(this,e,{deep:t,mode:"replace"})}var M,L,T,A=z({});function O(e,r,t){if(!Array.isArray(e)||0===e.length)throw new TypeError('The first argument to Immutable#setIn must be an array containing at least one "key" string.');var n=e[0];if(1===e.length)return P.call(this,n,r,t);var o,s=e.slice(1),i=this[n];if(o=this.hasOwnProperty(n)&&"object"==typeof i&&null!==i?z.setIn(i,s,r):O.call(A,s,r),this.hasOwnProperty(n)&&i===o)return this;var c=I(this,a(this));return c[n]=o,U(c)}function P(e,r,t){var n=t&&t.deep;if(this.hasOwnProperty(e)&&(n&&this[e]!==r&&u(r)&&u(this[e])&&(r=z.merge(this[e],r,{deep:!0,mode:"replace"})),l(this[e],r)))return this;var o=I(this,a(this));return o[e]=z(r),U(o)}function F(e,r){var t=Array.prototype.slice.call(arguments,2),n=this[e];return z.set(this,e,r.apply(n,[n].concat(t)))}function _(e,r){for(var t=0,n=r.length;null!=e&&t<n;t++)e=e[r[t]];return t&&t==n?e:void 0}function N(e,r){var t=Array.prototype.slice.call(arguments,2),n=_(this,e);return z.setIn(this,e,r.apply(n,[n].concat(t)))}function D(e,r){var t=_(this,e);return void 0===t?r:t}function W(e){var r,t=a(this);if(e&&e.deep)for(r in this)this.hasOwnProperty(r)&&(t[r]=C(this[r]));else for(r in this)this.hasOwnProperty(r)&&(t[r]=this[r]);return t}function B(){return{}}function U(e){return o.use_static||(s(e,"merge",j),s(e,"replace",R),s(e,"without",E),s(e,"asMutable",W),s(e,"set",P),s(e,"setIn",O),s(e,"update",F),s(e,"updateIn",N),s(e,"getIn",D)),f(e)}function z(e,r,t){if(c(e)||function(e){return"object"==typeof e&&null!==e&&(60103===e.$$typeof||e.$$typeof===n)}(e)||function(e){return"undefined"!=typeof File&&e instanceof File}(e)||function(e){return"undefined"!=typeof Blob&&e instanceof Blob}(e)||function(e){return e instanceof Error}(e))return e;if(function(e){return"object"==typeof e&&"function"==typeof e.then}(e))return e.then(z);if(Array.isArray(e))return b(e.slice());if(e instanceof Date)return a=new Date(e.getTime()),o.use_static||s(a,"asMutable",w),f(a);var a,i=r&&r.prototype,l=(i&&i!==Object.prototype?function(){return Object.create(i)}:B)();for(var u in e)Object.getOwnPropertyDescriptor(e,u)&&(l[u]=z(e[u],void 0,t));return U(l)}function V(e){return function(){var r=[].slice.call(arguments),t=r.shift();return e.apply(t,r)}}function $(e,r){return function(){var t=[].slice.call(arguments),n=t.shift();return Array.isArray(n)?r.apply(n,t):e.apply(n,t)}}return z.from=z,z.isImmutable=c,z.ImmutableError=h,z.merge=V(j),z.replace=V(R),z.without=V(E),z.asMutable=(M=W,L=x,T=w,function(){var e=[].slice.call(arguments),r=e.shift();return Array.isArray(r)?L.apply(r,e):r instanceof Date?T.apply(r,e):M.apply(r,e)}),z.set=$(P,m),z.setIn=$(O,S),z.update=V(F),z.updateIn=V(N),z.getIn=V(D),z.flatMap=V(v),z.asObject=V(k),o.use_static||(z.static=e({use_static:!0})),Object.freeze(z),z}();void 0===(n=function(){return o}.call(r,t,r,e))||(e.exports=n)}()},9244:e=>{"use strict";e.exports=t}},r={};function s(t){var n=r[t];if(void 0!==n)return n.exports;var o=r[t]={exports:{}};return e[t](o,o.exports,s),o.exports}s.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return s.d(r,{a:r}),r},s.d=(e,r)=>{for(var t in r)s.o(r,t)&&!s.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},s.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var i={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(i),s.d(i,{__set_webpack_public_path__:()=>Ae,default:()=>Te});var e=s(9244),r=s(2686),t=s(4321),n=s(655),o=s.n(n),a=s(5829);const c="Find address or place",l=["esri/widgets/Search","esri/widgets/Search/SearchViewModel","esri/widgets/Search/LocatorSearchSource","esri/widgets/Search/LayerSearchSource","esri/core/reactiveUtils","esri/core/promiseUtils","esri/Graphic","esri/layers/GraphicsLayer","esri/layers/FeatureLayer","esri/symbols/SimpleMarkerSymbol","esri/symbols/PictureMarkerSymbol","esri/rest/locator","esri/geometry/Point","esri/geometry/SpatialReference","esri/geometry/projection"],u={id:"default-locator",type:a.SK.Locator,name:"ArcGIS World Geocoding Service",placeholder:c,url:"https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",maxSuggestions:6},d=a.RB.Auto,p=a.RV.Default,h=/[-+]?\d[\d\s.,]*/g,f=/([ENen])\s*[:=]?\s*([-+]?\d[\d\s.,]*)/g,g=/\s+/g,m=/<[^>]*>/g,y=.001;if(!Number.isFinite(y))throw new Error("PRECISION_LIMITER must be a positive finite number");const S=3e4,b=8e5,w=59e5,v=78e5,E={STYLE:"x",COLOR:[32,108,255,.95],SIZE:14,OUTLINE_COLOR:[255,255,255,.9],OUTLINE_WIDTH:2},x={eMin:5e4,eMax:25e4,nMin:61e5,nMax:77e5},k={id:"sweref99-tm",epsg:3006,code:"EPSG:3006",name:"SWEREF 99 TM",shortName:"SWEREF 99 TM",type:"tm",centralMeridian:15,scaleFactor:.9996,falseEasting:5e5,falseNorthing:0,bounds:{eMin:3e5,eMax:7e5,nMin:61e5,nMax:77e5}},C=[{zoneId:"12 00",name:"SWEREF 99 12 00",epsg:3007,centralMeridian:12},{zoneId:"13 30",name:"SWEREF 99 13 30",epsg:3008,centralMeridian:13.5},{zoneId:"15 00",name:"SWEREF 99 15 00",epsg:3009,centralMeridian:15},{zoneId:"16 30",name:"SWEREF 99 16 30",epsg:3010,centralMeridian:16.5},{zoneId:"18 00",name:"SWEREF 99 18 00",epsg:3011,centralMeridian:18},{zoneId:"14 15",name:"SWEREF 99 14 15",epsg:3012,centralMeridian:14.25},{zoneId:"15 45",name:"SWEREF 99 15 45",epsg:3013,centralMeridian:15.75},{zoneId:"17 15",name:"SWEREF 99 17 15",epsg:3014,centralMeridian:17.25},{zoneId:"18 45",name:"SWEREF 99 18 45",epsg:3015,centralMeridian:18.75},{zoneId:"20 15",name:"SWEREF 99 20 15",epsg:3016,centralMeridian:20.25},{zoneId:"21 45",name:"SWEREF 99 21 45",epsg:3017,centralMeridian:21.75},{zoneId:"23 15",name:"SWEREF 99 23 15",epsg:3018,centralMeridian:23.25}].map((e=>({id:`sweref99-${e.zoneId.replace(/\s+/g,"").toLowerCase()}`,epsg:e.epsg,code:`EPSG:${e.epsg}`,name:e.name,shortName:e.name,type:"zone",zoneId:e.zoneId,centralMeridian:e.centralMeridian,scaleFactor:1,falseEasting:15e4,falseNorthing:0,bounds:x}))),I=[k,...C],j={};for(const e of I)j[e.epsg]=e;const R={};for(const e of C){R[Math.round(100*e.centralMeridian)/100]=e}Object.freeze(j),Object.freeze(R);var M=s(1888);const L=(r,t,n)=>{const o=`${n?.(1)} ${n?.(1.5)}`,a=(s=t?.label1,{font:`${s?.fontWeight?.toString()??""} ${s?.fontSize??""} ${s?.fontFamily??""}`.trim()});var s;return{actions:(0,e.css)({flex:"0 0 auto"}),sourceSelector:(0,e.css)({flex:"0 0 auto"}),resultsList:(0,e.css)({display:"flex",flex:"1 1 auto",flexDirection:"column",position:"absolute",inset:"100% 0 auto 0",marginBlockStart:n?.(1),background:r?.surface?.paper,overflow:"hidden",zIndex:2}),resultItem:(0,e.css)({display:"flex",flex:"0 0 auto",alignItems:"center",justifyContent:"space-between",...a,padding:o,cursor:"pointer","&:focus-visible":{outline:"none"}}),resultStatus:(0,e.css)({flex:"0 0 auto",padding:o}),coordinateBadge:(0,e.css)({display:"inline-flex",alignItems:"center",marginBlockEnd:n?.(1)}),coordinateDetails:(0,e.css)({display:"flex",flex:"1 1 auto",flexDirection:"column",...a,marginBlockStart:n?.(1),gap:n?.(.5)}),coordinateLabel:(0,e.css)({...a}),coordinateValue:(0,e.css)({}),coordinateWarning:(0,e.css)({display:"flex",flex:"1 1 auto",alignItems:"center",gap:n?.(.5)}),coordinateLoading:(0,e.css)({display:"flex",flex:"1 1 auto",alignItems:"center",gap:n?.(.5)})}},T=(r,t=a.RV.Default)=>{const n=r.sys?.color,o=r.sys?.typography,s=r.sys?.spacing;return t===a.RV.Linear?((r,t,n,o)=>({...L(t,n,o),container:(0,e.css)({display:"flex",background:"transparent"}),controls:(0,e.css)({display:"flex",alignItems:"center",borderBottom:`1px solid ${r?.ref?.palette?.neutral?.[500]}`,width:"100%"}),inputArea:(0,e.css)({flex:"1 1 auto",minWidth:0,".esri-widget, .esri-input, .esri-select, .esri-search, .esri-search__input, .esri-search__input-container, .esri-search .esri-search__container > .esri-widget--button, .esri-search__input-container .esri-search__clear-button":{background:"transparent !important"},".esri-input, .esri-select, .esri-search .esri-search__container > .esri-widget--button":{border:"transparent !important"},".esri-search":{width:"100% !important"},".esri-search__input-container":{position:"relative"},".esri-search__input-container .esri-search__clear-button":{right:"0 !important"}})}))(r,n,o,s):((r,t,n)=>({...L(r,t,n),container:(0,e.css)({display:"flex"}),controls:(0,e.css)({display:"flex",alignItems:"center",width:"100%",".esri-widget":{backgroundColor:"transparent !important"}}),inputArea:(0,e.css)({flex:"1 1 auto",minWidth:0,".esri-search":{width:"100% !important"},".esri-search__input-container":{position:"relative"},".esri-search .esri-search__container > .esri-widget--button":{background:r?.surface?.paperHint,color:r?.surface?.background},".esri-search__input-container .esri-search__clear-button":{right:"0 !important"}})}))(n,o,s)};var A=s(4058);const O=e=>{if(null==e)return null;const r=e;return"function"==typeof r.asMutable?r.asMutable({deep:!0}):e},P=e=>e?.toString?.().replace(/[\r\n]+/g," ").trim()??"",F=(e,r)=>P(e)||r,_=e=>"string"==typeof e?e:"number"==typeof e||"boolean"==typeof e?String(e):"",N=e=>Array.isArray(e)?e.map(P).filter(Boolean):[],D=e=>{const r=P(e);if(!r)return"";try{return new URL(r).toString()}catch{return""}},W=e=>"number"==typeof e&&Number.isFinite(e),B=(e,r)=>{const t="number"==typeof e?e:parseInt(e,10);return W(t)&&t>0?Math.round(t):r},U=(e,r,t,n)=>{const o=`search-source-${r}`,a=`Source ${r+1}`;return{id:F(_(e?.id??""),o),name:F(_(e?.name??""),a),placeholder:F(_(e?.placeholder??""),t),maxSuggestions:"number"==typeof e?.maxSuggestions?B(e.maxSuggestions,n):n}},z=(e,r)=>{const t=O(e??null)??(n=e,Boolean(n&&"object"==typeof n&&!("asMutable"in n))?e:{});var n;const o=F(_(t.placeholder??""),c),s="number"==typeof t.maxSuggestions?B(t.maxSuggestions,6):6,i="number"==typeof t.zoomScale&&t.zoomScale>0?t.zoomScale:1e4,l=(Array.isArray(t.searchSources)?t.searchSources:[]).map(((e,r)=>e.type===a.SK.Layer?((e,r,t,n)=>{const o=U(e,r,t,n),s=N(e?.searchFields),i="number"==typeof e?.minSuggestCharacters?B(e.minSuggestCharacters,3):void 0;return{...o,type:a.SK.Layer,url:D(_(e?.url??"")),layerId:F(e?.layerId??"",""),searchFields:s,displayField:P(e?.displayField??"")||void 0,exactMatch:"boolean"==typeof e?.exactMatch?e.exactMatch:void 0,minSuggestCharacters:i,resultSymbol:e?.resultSymbol?{...e.resultSymbol}:void 0}})(e,r,o,s):((e,r,t,n)=>{const o=U(e,r,t,n),s=D(_(e?.url??u.url)),i=N(e?.categories),c=N(e?.outFields),l=P(e?.countryCode??"").replace(/[^A-Za-z]/g,"").slice(0,3).toUpperCase(),d=P(e?.locationType??"").toLowerCase(),p="street"===d||"rooftop"===d?d:void 0;return{...o,type:a.SK.Locator,url:s||u.url,apiKey:P(e?.apiKey??"")||void 0,categories:i.length?i:void 0,countryCode:l||void 0,locationType:p,withinViewEnabled:"boolean"==typeof e?.withinViewEnabled?e.withinViewEnabled:void 0,outFields:c.length?c:void 0}})(e,r,o,s))),h=r?.ensureDefaultSource??!0,f=l.length||!h?l:[{...u,placeholder:o,maxSuggestions:s}];return{placeholder:o,maxSuggestions:s,zoomScale:i,persistLastSearch:"boolean"!=typeof t.persistLastSearch||t.persistLastSearch,enableCoordinateSearch:"boolean"!=typeof t.enableCoordinateSearch||t.enableCoordinateSearch,coordinateZoomScale:"number"==typeof t.coordinateZoomScale&&t.coordinateZoomScale>0?t.coordinateZoomScale:1e4,preferredProjection:t.preferredProjection??d,showCoordinateBadge:"boolean"!=typeof t.showCoordinateBadge||t.showCoordinateBadge,styleVariant:t.styleVariant??p,searchSources:f}},V=e=>"point"===e?.type?e:null,$=e=>{if(!e)return"";return Array.from(e).filter((e=>{const r=e.charCodeAt(0);return r>=32&&127!==r})).join("").replace(/\s+/g," ").replace(/[<>]/g,"").trim().slice(0,256)},G=e=>"extent"===e?.type?e:null,J=(e,r)=>{const t=e,n=t.graphic??e.feature??null,o=V(t.location??null)??V(n?.geometry??null),a=G(t.extent??null)??G(n?.geometry?.extent??null)??null,s=n?.attributes&&"object"==typeof n.attributes?{...n.attributes}:void 0,i=s?.Match_addr,c="string"==typeof i?i:"",l=e?.name??"";return{sourceIndex:r,name:l,text:l||c,feature:n,extent:a,location:o,attributes:s}},Z=(e,r)=>{const{LocatorSearchSource:t}=e,n={name:r.name,placeholder:r.placeholder,url:r.url,apiKey:r.apiKey,maxResults:r.maxSuggestions,maxSuggestions:r.maxSuggestions,suggestionsEnabled:!0,minSuggestCharacters:3};if(Array.isArray(r.categories)&&r.categories.length&&(n.categories=r.categories),r.countryCode&&(n.countryCode=r.countryCode),r.locationType){const e=r.locationType.toLowerCase();"street"!==e&&"rooftop"!==e||(n.locationType=e)}return"boolean"==typeof r.withinViewEnabled&&(n.withinViewEnabled=r.withinViewEnabled),Array.isArray(r.outFields)&&r.outFields.length&&(n.outFields=r.outFields),new t(n)},K=(e,r,t)=>{const{LayerSearchSource:n,SimpleMarkerSymbol:o}=e,a={layer:r,name:t.name,placeholder:t.placeholder,displayField:t.displayField??r.displayField??void 0,outFields:["*"],searchFields:t.searchFields?.length?t.searchFields:void 0,exactMatch:Boolean(t.exactMatch),maxResults:t.maxSuggestions,maxSuggestions:t.maxSuggestions,suggestionsEnabled:!0,minSuggestCharacters:t.minSuggestCharacters??3};if(t.resultSymbol)try{a.resultSymbol=new o(t.resultSymbol)}catch(e){console.log("Search widget: failed to apply custom result symbol",e)}return new n(a)},H=e=>e?.type===a.SK.Locator,Y=e=>e?.type===a.SK.Layer,q=e=>{let r=e.replace(m,"");return r=Array.from(r).filter((e=>{const r=e.charCodeAt(0);return r>=32&&r<=126||r>=160&&r<=255})).join(""),r.replace(g," ").trim()},Q=e=>{if(e.replace(/[^0-9]/g,"").length>18)return null;const r=(e=>{let r=e.replace(/[\u00A0]/g," ").replace(/[^0-9\s,.-]/g,"");if(!r||/[,.-]{2,}/.test(r)||/^[,.]+|[,.-]+$/.test(r.replace(/^-/,"")))return"";let t="";r.startsWith("-")?(t="-",r=r.slice(1)):r.startsWith("+")&&(r=r.slice(1)),r=r.replace(/[+-]/g,"");const n=(e,r)=>{const t=e.replace(/[,.-]/g,""),n=r.replace(/[,.-]/g,"");return t||n?n?`${t}.${n}`:t:""},o=r.split(/\s+/).filter(Boolean);o.length>1&&o[0].length<=3&&o.slice(1).every((e=>3===e.length))&&(r=r.replace(/\s+/g,""));const a=(r.match(/\./g)??[]).length,s=(r.match(/,/g)??[]).length,i=a+s;if(0===i)return t+r;if(i>2)return"";if(1===i){const e=r.split(/[,.]/);return t+n(e[0],e[1])}if(a>1)return t+r.replace(/\./g,"");if(s>1)return t+r.replace(/,/g,"");const c=r.lastIndexOf(","),l=r.lastIndexOf("."),u=Math.max(c,l);return t+n(r.slice(0,u).replace(/[,.]/g,""),r.slice(u+1))})(e);if(!r)return null;if(r.replace(/[^0-9]/g,"").length>15)return null;const t=Number.parseFloat(r);return Number.isNaN(t)||!Number.isFinite(t)||Math.abs(t)>1e8?null:Math.abs(t)<y?0:t},X=e=>e.match(h)??[],ee=(e,r)=>{const t=Math.abs(e),n=Math.abs(r);return t<=90&&n<=180||t<=90&&n<=90},re=(e,r)=>{if(ee(e,r))return null;const t=e>=S&&e<=b,n=e>=w&&e<=v,o=r>=S&&r<=b,a=r>=w&&r<=v;return t&&!n&&a&&!o?{easting:e,northing:r}:n&&!t&&o&&!a?{easting:r,northing:e}:!t||o||a?!o||t||n?t&&a?{easting:e,northing:r,warning:o?"coordinateWarningAmbiguousOrder":void 0}:n&&o?{easting:r,northing:e,warning:t?"coordinateWarningAmbiguousOrder":void 0}:null:{easting:r,northing:e}:{easting:e,northing:r}},te=(e,r,t,n,o)=>ee(e,r)?{success:!1,error:"coordinateErrorNotSweref"}:pe({easting:e,northing:r})?{success:!0,easting:e,northing:r,format:t,sanitized:n,warning:o}:{success:!1,error:"coordinateErrorOutOfRange"},ne=e=>{if(!e)return{success:!1,error:"coordinateErrorEmpty"};const r=q(e);if(!r)return{success:!1,error:"coordinateErrorEmpty"};if(r.length>200)return{success:!1,error:"coordinateErrorTooLong"};const t=/[ENen]\s*[:=]/.test(n=r)?a.Mc.Labeled:/\d\s*,\s*\d/.test(n)?a.Mc.CommaSeparated:/\d\s+\d/.test(n)?a.Mc.SpaceSeparated:a.Mc.Unknown;var n;if(t===a.Mc.Labeled){const e=(e=>{let r=null,t=null;for(const n of e.matchAll(f)){const e=n[1].toUpperCase(),o=Q(n[2]);null!==o&&("E"===e?r=o:"N"===e&&(t=o))}return{easting:r,northing:t}})(r);if(null!==e.easting&&null!==e.northing)return te(e.easting,e.northing,a.Mc.Labeled,r)}let o=X(r);if(o.length<2){const e=r.split(/\s+/).map((e=>e.replace(/^[,;]+|[,;]+$/g,""))).filter((e=>e.length>0));e.length>=2&&(o=e.slice(0,2))}if(o.length<2)return{success:!1,error:"coordinateErrorParse"};const s=o.slice(0,2).map(Q),i=s[0],c=s[1];if(null===i||null===c)return{success:!1,error:"coordinateErrorParse"};const l=re(i,c);if(!l)return{success:!1,error:"coordinateErrorParse"};const{easting:u,northing:d,warning:p}=l;return te(u,d,t===a.Mc.Unknown?r.includes(",")?a.Mc.CommaSeparated:a.Mc.SpaceSeparated:t,r,p)},oe=e=>q(e).slice(0,200),ae=e=>!(!e||"object"!=typeof e)&&(!!("number"==typeof e.wkid&&W(e.wkid)&&e.wkid>0)||"string"==typeof e.wkt&&e.wkt.trim().length>0),se=e=>{return!!e&&(!!((r=e)&&"object"==typeof r&&"number"==typeof r.x&&"number"==typeof r.y&&Number.isFinite(r.x)&&Number.isFinite(r.y))&&(!(!e.spatialReference||"object"!=typeof e.spatialReference)&&ae(e.spatialReference)));var r},ie=e=>{if(!e)return!1;return Boolean(e.destroyed)},ce=e=>{e?.destroy?.()},le=[/\b(gata|gatan|v\xe4g|v\xe4gen|plan|torg|torget|all\xe9|all\xe9n)\b/i,/\b\d{3}\s?\d{2}\b/,/\b(stockholm|g\xf6teborg|malm\xf6|uppsala|link\xf6ping)\b/i],ue=(e,r,t)=>e>=r&&e<=t,de=(e,r,t)=>{const{eMin:n,eMax:o,nMin:a,nMax:s}=r;return"e"===t?ue(e,n,o):ue(e,a,s)},pe=e=>ue(e.easting,S,b)&&ue(e.northing,w,v),he=(e,r)=>{if(0===e.length||!r)return e;const t=(e=>{let r=C[0],t=Number.POSITIVE_INFINITY;for(const n of C){const o=Math.abs(n.centralMeridian-e);o<t&&(r=n,t=o)}return r})(r);return[...e].sort(((e,n)=>e===t?-1:n===t?1:Math.abs(e.centralMeridian-r)-Math.abs(n.centralMeridian-r)))},fe=(e,r,t,n)=>{const o=[];if(e){const{bounds:r}=e,t=5e3;(Math.abs(n-r.eMin)<=t||Math.abs(r.eMax-n)<=t)&&o.push("coordinateWarningNearBoundary")}return{projection:e,confidence:r,alternatives:t,warnings:o}},ge=e=>{const{easting:r,northing:t,preference:n=d}=e,o=(e=>{if(!e)return null;let r=null;return"number"==typeof e.longitude?r=e.longitude:"number"==typeof e.x&&4326===e.spatialReference?.wkid&&(r=e.x),null!==r&&(r<-180||r>180)?null:r})(e.mapCenter),s=r>=3e5&&r<=7e5,i=r>=5e4&&r<=25e4?((e,r)=>C.filter((t=>de(e,t.bounds,"e")&&de(r,t.bounds,"n"))))(r,t):[];if(n===a.RB.Zone&&i.length){const e=he(i,o);return fe(e[0],1,e.slice(1),r)}if(n===a.RB.Tm&&s)return fe(k,.9,i,r);if(1===i.length)return fe(i[0],1,[],r);if(i.length>1){const e=he(i,o);return fe(e[0],null===o?.7:.85,e.slice(1),r)}return s?fe(k,.6,[],r):{projection:null,confidence:0,alternatives:[],warnings:["coordinateErrorNoProjection"]}},me=(e,r)=>ue(e,3e4,8e5)&&ue(r,59e5,78e5),ye=e=>{const{easting:r,northing:t,projection:n}=e,o=[],a=[];return W(r)&&W(t)?(n&&!((e,r,t)=>{if(!t)return me(e,r);const{bounds:n}=t;return ue(e,n.eMin,n.eMax)&&ue(r,n.nMin,n.nMax)})(r,t,n)?o.push("coordinateErrorOutOfBounds"):me(r,t)||o.push("coordinateErrorOutOfRange"),!o.length&&n&&a.push(...((e,r)=>{const{bounds:t}=r,n=Math.abs(e-t.eMin)<=5e3,o=Math.abs(t.eMax-e)<=5e3;return n||o?["coordinateWarningNearBoundary"]:[]})(r,n)),{valid:0===o.length,errors:o,warnings:a}):{valid:!1,errors:["coordinateErrorInvalidNumber"],warnings:a}},Se=new WeakMap,be=new WeakMap,we=e=>{if(!e.spatialReference)throw new Error("coordinateErrorNoSpatialReference");if(!e.projection?.epsg||!W(e.projection.epsg)||e.projection.epsg<=0)throw new Error("coordinateErrorInvalidProjection");if(!W(e.easting)||!W(e.northing))throw new Error("coordinateErrorInvalidCoordinates")},ve=async e=>{const{modules:r,spatialReference:t}=e,{projection:n}=r;we(e);const o=(e=>{const{modules:r,projection:t,easting:n,northing:o}=e,{SpatialReference:a,Point:s}=r;return we(e),new s({x:n,y:o,spatialReference:new a({wkid:t.epsg})})})(e);if(o.spatialReference?.wkid===t.wkid)return o;try{await(async e=>{if(!e)throw new Error("Projection module unavailable");const r=Se.get(e);if(r)return r;if(be.get(e)){await new Promise((e=>setTimeout(e,10)));const r=Se.get(e);if(r)return r}let t;be.set(e,!0);const n=(async()=>{const r=new Promise(((e,r)=>{t=setTimeout((()=>{r(new Error("coordinateErrorProjectionTimeout"))}),5e3)}));try{await Promise.race([e.load().catch((e=>{throw e instanceof Error?e:new Error("string"==typeof e?e:"Projection load failed")})),r])}catch(r){throw t&&clearTimeout(t),be.delete(e),Se.delete(e),r instanceof Error?r:new Error("string"==typeof r?r:"Projection load failed")}finally{t&&clearTimeout(t),be.delete(e)}})();Se.set(e,n);try{await n}catch(r){throw Se.delete(e),r instanceof Error?r:new Error("coordinateErrorProjectionLoad")}})(n);const e=n.project(o,t);if(!(e=>{if(!e||"object"!=typeof e)return!1;const r=e;return"number"==typeof r.x&&"number"==typeof r.y})(e))throw new Error("coordinateErrorTransform");return(e=>{if(!W(e.x)||!W(e.y))throw new Error("coordinateErrorTransform")})(e),e.spatialReference||(e.spatialReference=t),e}catch(e){if(e instanceof Error)throw e;throw new Error(null!=e?String(e):"coordinateErrorTransform")}},Ee=(e,r)=>0===r?-1:Math.min(Math.max(0,e),r-1),xe=()=>{const[t,n]=e.React.useState(null),[o,a]=e.React.useState(null),s=e.hooks.useCancelablePromiseMaker();return e.hooks.useEffectOnce((()=>{s((async()=>{const[e,t,n,o,a,s,i,c,u,d,p,h,f,g,m]=await(0,r.loadArcGISJSAPIModules)(l.slice());return{Search:e,SearchViewModel:t,LocatorSearchSource:n,LayerSearchSource:o,FeatureLayer:u,reactiveUtils:a,promiseUtils:s,Graphic:i,GraphicsLayer:c,SimpleMarkerSymbol:d,PictureMarkerSymbol:p,locator:h,Point:f,SpatialReference:g,projection:m}})()).then(n).catch((e=>{"AbortError"!==e?.name&&a(e)}))})),{modules:t,error:o}},ke=async e=>{if(!e?.when)return!1;try{return await Promise.race([e.when(),new Promise(((e,r)=>{setTimeout((()=>{r(new Error("Layer load timeout"))}),1e4)}))]),(e=>Boolean(e&&"feature"===e.type&&"failed"!==e.loadStatus&&!e.isTable))(e)}catch(e){return console.log("Search widget: layer load failed",e),!1}},Ce=(e,r)=>{try{return new e.FeatureLayer({id:r.layerId||void 0,url:r.url,outFields:["*"]})}catch(e){return console.log("Search widget: failed to instantiate FeatureLayer",r.layerId||r.url,e),null}},Ie=r=>{const{mapView:t,container:n,modules:o,config:a,activeSourceIndex:s,lastSearchTerm:i,zoomScale:c,onSearchStart:l,onSearchComplete:u,onResultSelect:d,onSearchClear:p,onSearchError:h,onActiveSourceChange:f,onInputChange:g}=r,m=e.React.useRef(null),y=e.React.useRef([]),S=e.React.useRef(0),b=e.hooks.useLatest(t),w=e.hooks.useLatest(o),v=e.hooks.useLatest(a),E=e.hooks.useLatest(s),x=e.hooks.useLatest(i),k=e.hooks.useLatest(c),C=e.hooks.useLatest(l),I=e.hooks.useLatest(u),j=e.hooks.useLatest(d),R=e.hooks.useLatest(p),M=e.hooks.useLatest(h),L=e.hooks.useLatest(f),T=e.hooks.useLatest(g),A=e.React.useRef($(i??"")),O=e.React.useRef(s),P=e.hooks.useEventCallback((()=>{y.current.forEach((e=>{e.remove()})),y.current=[]})),F=e.hooks.useEventCallback((e=>{const r=w.current;if(!r?.reactiveUtils||!e?.viewModel)return[];const t=[],n=e.viewModel;return t.push(r.reactiveUtils.watch((()=>n.activeSourceIndex),(r=>{const t=e.sources?.length??0,n=Ee("number"==typeof r?r:0,t);if(n<0)return;if(n===O.current)return;n!==Ee(E.current??0,t)?(O.current=n,L.current?.(n)):O.current=n}))),t.push(r.reactiveUtils.watch((()=>n.searchTerm),(e=>{const r=$(e??"");r!==A.current&&(A.current=r,T.current?.(r))}))),t})),_=e.hooks.useEventCallback((e=>{P();const r=[e.on("search-start",(e=>{const r=e,t=$(r?.searchTerm??"");A.current=t,C.current?.(t)})),e.on("search-complete",(e=>{const r=e,t=(r?.results??[]).flatMap(((e,r)=>{const t=e??{},n="number"==typeof t.sourceIndex?t.sourceIndex:r;return(t.results??[]).map((e=>J(e,n)))}));I.current?.(t)})),e.on("select-result",(e=>{const r=e,t=r?.result;if(t){const e=J(t,t?.sourceIndex??0);j.current?.(e)}})),e.on("search-clear",(()=>{A.current="",T.current?.(""),R.current?.()})),e.on("search-error",(e=>{const r=e;r?.error instanceof Error&&M.current?.(r.error)}))],t=F(e);t.length&&r.push(...t),y.current=r})),N=e.hooks.useEventCallback((async(e,r)=>{if(!r)return;const t=++S.current,n=v.current,o=await(async e=>{const{configSources:r,modules:t,mapView:n}=e;if(!r?.length)return[];const o=[],a=n?.view;for(const e of r){if(H(e)){o.push(Z(t,e));continue}if(!Y(e))continue;let r=a?.map?.findLayerById(e.layerId);if(r||(r=Ce(t,e),r))if(await ke(r))try{o.push(K(t,r,e))}catch(r){console.log("Search widget: failed to create layer source",e.layerId||e.url,r)}else console.log("Search widget: layer failed to load or invalid",e.layerId||e.url)}return o})({configSources:n.searchSources,modules:r,mapView:b.current??null});if(t!==S.current)return;const a=o.length>0?Ee(E.current??0,o.length):-1,s={includeDefaultSources:!1,sources:o,maxSuggestions:n.maxSuggestions,searchAllEnabled:!1,autoSelect:!1,popupEnabled:!0,locationEnabled:!1,placeholder:n.placeholder,searchTerm:n.persistLastSearch&&x.current?x.current:n.persistLastSearch?e.searchTerm:"",view:b.current?.view??e.view};o.length>0&&a>=0&&(s.activeSourceIndex=a),Object.assign(e,s)}));return e.hooks.useUpdateEffect((()=>{if(!w.current||!n)return ce(m.current),void(m.current=null);const e=new w.current.Search({container:n,popupEnabled:!0,popupOpenOnSelect:!0,maxSuggestions:v.current.maxSuggestions,locationEnabled:!1,placeholder:v.current.placeholder});if(Object.assign(e,{includeDefaultSources:!1,searchAllEnabled:!1,autoSelect:!1}),e.viewModel){const r=(e,r)=>{const t=r?.target??null,n=e??b.current?.view??null;if(!n||!t)return Promise.resolve();const o=n;if("function"!=typeof o?.goTo)return Promise.resolve();const a={animate:!0,duration:800},s=k.current??0,i=Number.isFinite(s)&&s>=1&&s<=1e9?s:null;if(null!==i&&i>0)return o.goTo({target:t,scale:i},a).catch((()=>{}));if((c=t)&&"object"==typeof c&&"extent"===c.type&&"function"==typeof t.expand)try{const e=t.expand(1.2);return o.goTo(e,a).catch((()=>{}))}catch{}var c;return o.goTo(t,a).catch((()=>{}))};e.viewModel.goToOverride=r}m.current=e,_(e);let r=!1;return(async()=>{try{await N(e,w.current)}catch(e){r||console.log("Failed to apply widget config:",e)}})(),()=>{r=!0,P(),ce(e),m.current=null}}),[o,n,t]),e.hooks.useUpdateEffect((()=>{m.current&&w.current&&N(m.current,w.current)}),[a.searchSources,a.maxSuggestions,a.placeholder,a.persistLastSearch,a.zoomScale]),e.hooks.useUpdateEffect((()=>{if(m.current){const e=m.current.sources?.length??0,r=Ee(s,e);m.current.activeSourceIndex=Math.max(0,r)}O.current=s}),[s]),e.hooks.useUnmount((()=>{P(),ce(m.current),m.current=null})),m},je=r=>{const t=(()=>{const r=e.hooks.useEventCallback((e=>oe(e??""))),t=e.hooks.useEventCallback((e=>{const t=r(e),n=ne(t);return n.success?{...n,sanitized:t}:n}));return{sanitizeInput:r,parseCoordinates:t}})(),n=(r=>{const t=e.hooks.useLatest(r.mapView??null),n=e.hooks.useLatest(r.preference??d);return{detectProjection:e.hooks.useEventCallback(((e,r)=>ge({easting:e,northing:r,mapCenter:t.current?.view?.center??null,preference:n.current})))}})({mapView:r.mapView,preference:r.preference}),o=(r=>{const t=e.hooks.useLatest(r.modules),n=e.hooks.useLatest(r.mapView);return{transform:e.hooks.useEventCallback((async e=>{const r=t.current,o=n.current?.view??null;if(!r)throw new Error("coordinateErrorMissingModules");if(!o)throw new Error("coordinateErrorNoMapView");const a=await ve({easting:e.easting,northing:e.northing,projection:e.projection,modules:r,spatialReference:o.spatialReference??null});if(!a)throw new Error("coordinateErrorTransform");return a}))}})({modules:r.modules,mapView:r.mapView}),s=e.React.useRef(0),i=e.hooks.useLatest(r.onSuccess),c=e.hooks.useLatest(r.onError),l=e.hooks.useLatest(r.modules),u=e.React.useRef(null),p=e.hooks.useEventCallback((()=>{const e=u.current;if(e?.cancel)try{e.cancel()}catch(e){e instanceof Error&&!e.message.includes("abort")&&!e.message.includes("cancel")&&console.log("Unexpected debounce cancellation error:",e)}u.current=null})),h=e.hooks.useEventCallback((async e=>{const r=++s.current;let l=!1;const u=()=>{if(r!==s.current)throw new Error("coordinateSearchOutdated")},d=e=>{throw u(),l=!0,c.current?.(e),new Error(e)};try{const c=t.parseCoordinates(e);if(u(),!c.success||void 0===c.easting||void 0===c.northing){return d(c.error??"coordinateErrorParse")}const l=c.warning?[c.warning]:[],p=n.detectProjection(c.easting,c.northing);if(u(),!p.projection)return d("coordinateErrorNoProjection");const h=ye({easting:c.easting,northing:c.northing,projection:p.projection});if(u(),!h.valid){return d(h.errors[0]??"coordinateErrorOutOfBounds")}const f=await o.transform({easting:c.easting,northing:c.northing,projection:p.projection});u();const g=Array.from(new Set([...l,...p.warnings??[],...h.warnings])),m={point:f,projection:p.projection,easting:c.easting,northing:c.northing,validation:h,format:c.format??a.Mc.Unknown,confidence:p.confidence,alternatives:p.alternatives,warnings:g};if(r!==s.current)throw new Error("coordinateSearchOutdated");return i.current?.(m),m}catch(e){if(e instanceof Error&&"coordinateSearchOutdated"===e.message)throw e;const t=e instanceof Error&&e.message?e.message:"coordinateErrorGeneric";throw l||r!==s.current||c.current?.(t),new Error(t)}}));e.hooks.useUpdateEffect((()=>{p();const e=l.current;return e?.promiseUtils?.debounce&&(u.current=e.promiseUtils.debounce((e=>h(e)))),()=>{p()}}),[r.modules]),e.hooks.useUnmount(p);return{searchCoordinates:e.hooks.useEventCallback((e=>{const r=u.current;return r?r(e):h(e)})),sanitizeInput:t.sanitizeInput}},Re={searchPlaceholder:"Search for address or place",searchAriaLabel:"Search for place or feature",searchButton:"Search",clearSearch:"Clear search",selectSource:"Select search source",noResultsFound:"No results found",errorSearchFailed:"Search failed. Please try again.",loadingResults:"Loading results...",resultCount:"{count} results found",resultFromSource:"From {source}",searchModeLabel:"Choose search mode",modeGeocodingLabel:"Search",modeCoordinatesLabel:"Coordinates",placeholderCoordinates:"Paste SWEREF 99 coordinates (e.g. 123456 7890123)",coordinateHintUnlabeled:"Enter two coordinates separated by space or comma",coordinateHintLabeled:"Use E= and N= to specify axis order",coordinateProjectionAria:"Detected coordinate system: {projection}",coordinateEasting:"Easting",coordinateNorthing:"Northing",coordinateErrorEmpty:"Enter coordinates to search.",coordinateErrorTooLong:"Coordinate input is too long.",coordinateErrorParse:"Could not parse coordinates. Try format: E=123456 N=7890123.",coordinateErrorNotSweref:"The coordinates do not look like SWEREF 99 values.",coordinateErrorOutOfRange:"Coordinates are outside the valid SWEREF 99 range.",coordinateErrorOutOfBounds:"Coordinates are outside the detected projection bounds.",coordinateErrorInvalidNumber:"Coordinates must be numeric.",coordinateErrorNoProjection:"Could not detect a SWEREF 99 projection for these coordinates.",coordinateErrorGeneric:"Coordinate search failed. Please try again.",coordinateErrorProjectionTimeout:"Projection tools took too long to load.",coordinateErrorProjectionLoad:"Could not load projection tools.",coordinateErrorNoSpatialReference:"Map spatial reference is unavailable.",coordinateErrorTransform:"Could not transform coordinates to the map projection.",coordinateErrorMissingModules:"Coordinate tools are not ready yet.",coordinateErrorNoMapView:"The map view is unavailable.",coordinateWarningNearBoundary:"Coordinates are near the projection boundary. Verify the projection.",coordinateWarningAmbiguousOrder:"Coordinates could be interpreted multiple ways. Use E= and N= to be sure.",searchNavigationFailed:"Could not navigate to the result."},Me=new Map(I.map((e=>[e.id,e]))),Le=e=>e?Me.get(e)??null:null,Te=n=>{const{id:s,useMapWidgetIds:i}=n,c=e.hooks.useTranslation(Re),l=z(n.config),u=((r=a.RV.Default)=>{const t=(0,M.useTheme)(),n=e.React.useRef(null),o=e.React.useRef(t),s=e.React.useRef(r);let i=n.current;return i&&o.current===t&&s.current===r||(i=T(t,r),n.current=i,o.current=t,s.current=r),i})(l.styleVariant??p),d=Array.isArray(i)?i.find((e=>"string"==typeof e&&e.trim().length>0))?.trim()??null:null,h=e.React.useRef((0,A.createDefaultWidgetState)()),f=e.ReactRedux.useDispatch(),g=e.ReactRedux.useSelector((e=>e.searchWidgetState?.byId?.[s]??h.current)),[m,y]=e.React.useState(null),[S,b]=e.React.useState(null),[w,v]=e.React.useState(!1),[x,k]=e.React.useState(!1),[C,I]=e.React.useState(null),j=e.React.useRef([]),R=O(g.results)??[],L=O(g.coordinateResult),{modules:P,error:F}=xe(),_=e.hooks.useEventCallback((e=>{y(e)}));e.hooks.useUpdateEffect((()=>{d||y(null)}),[d]);const N=e.hooks.useEventCallback((e=>{e!==S&&b(e)})),D=e.hooks.useEventCallback((()=>{v((e=>!e))})),W=e.hooks.useEventCallback((()=>{v(!1)})),B=e.hooks.useEventCallback((e=>{f(A.searchActions.setSearching(e,s))})),U=e.hooks.useEventCallback((e=>{f(A.searchActions.setLastSearchTerm(e,s))})),V=e.hooks.useEventCallback((()=>{j.current=[],f(A.searchActions.clearResults(s))})),$=e.hooks.useEventCallback((e=>{f(A.searchActions.setResults(e,s))})),G=e.hooks.useEventCallback((e=>{f(A.searchActions.setError(e,s))})),J=e.hooks.useEventCallback((e=>{f(A.searchActions.setActiveSource(e,s))})),Z=e.hooks.useEventCallback((e=>{f(A.searchActions.setCoordinateInput(e,s))})),K=e.hooks.useEventCallback((e=>{f(A.searchActions.setCoordinateResult(e,s))})),H=e.hooks.useEventCallback((()=>{f(A.searchActions.clearCoordinateResult(s))})),Y=e.hooks.useLatest(P),q=e.hooks.useLatest(g.isCoordinateInput),te=e.React.useRef(!1),ne=e.React.useRef(""),ce=`${s}-coordinate-layer`,{updateGraphic:ue,clearGraphics:de,goToPoint:pe}=(r=>{const{id:t,modules:n,mapView:o,enabled:a,zoomScale:s,defaultZoomScale:i,symbol:c}=r,l=e.hooks.useLatest(n),u=e.hooks.useLatest(o),d=e.hooks.useLatest("number"==typeof s&&Number.isFinite(s)?s:null),p=e.hooks.useLatest(i),h=e.React.useRef(null),f=e.React.useRef(null),g=e.hooks.useEventCallback(((e,r)=>{e&&r?.map&&r.map.findLayerById(e.id)===e&&r.map.remove(e)}));e.hooks.useUpdateEffect((()=>{const e=o?.view??null,r=l.current,n=h.current,s=f.current;if(!a)return g(n,s),h.current===n&&(h.current=null),void(f.current===s&&(f.current=null));if(!e||!r)return;let i=e.map?.findLayerById(t);if(!i)try{i=new r.GraphicsLayer({id:t,listMode:"hide"}),e.map?.add(i)}catch(e){return void console.log("Search widget: failed to initialize coordinate graphics layer",e)}return h.current=i??null,f.current=e,()=>{i&&e&&g(i,e),h.current===i&&(h.current=null),f.current===e&&(f.current=null)}}),[a,o,n,t,g]);const m=e.hooks.useEventCallback((()=>{const e=h.current;if(e)if(ie(e))h.current=null;else try{e.removeAll()}catch(r){console.log("Search widget: failed to clear coordinate graphics",r),h.current===e&&(h.current=null)}})),y=e.hooks.useEventCallback((e=>{const r=h.current,t=l.current;if(r&&t)if(ie(r))h.current=null;else try{r.removeAll();const n=((e,r)=>new e.SimpleMarkerSymbol({style:r.style,color:r.color,size:r.size,outline:{color:r.outlineColor,width:r.outlineWidth}}))(t,c),o=new t.Graphic({geometry:e,symbol:n});r.add(o)}catch(e){console.log("Search widget: failed to update coordinate graphic",e),h.current===r&&(h.current=null)}})),S=e.hooks.useEventCallback((e=>{const r=f.current??u.current?.view??null;if(!r||"function"!=typeof r.goTo)return;const t=d.current??p.current??null;null===t||!Number.isFinite(t)||t<=0||r.goTo({target:e,scale:t},{animate:!0}).catch((()=>{}))}));return e.hooks.useUnmount((()=>{g(h.current,f.current),h.current=null,f.current=null})),{updateGraphic:y,clearGraphics:m,goToPoint:S}})({id:ce,modules:P,mapView:m,enabled:Boolean(l.enableCoordinateSearch),zoomScale:l.coordinateZoomScale,defaultZoomScale:1e4,symbol:{style:E.STYLE,color:E.COLOR,size:E.SIZE,outlineColor:E.OUTLINE_COLOR,outlineWidth:E.OUTLINE_WIDTH}}),he=je({modules:P,mapView:m,preference:l.preferredProjection,onSuccess:e=>{q.current&&(k(!1),K((e=>({projectionId:e.projection.id,easting:e.easting,northing:e.northing,warnings:[...e.warnings??[]],confidence:e.confidence,format:e.format,alternativeProjectionIds:(e.alternatives??[]).map((e=>e.id)),mapPoint:"function"==typeof e.point?.toJSON?e.point.toJSON():null}))(e)),ue(e.point),pe(e.point),G(null))},onError:e=>{if(!q.current)return;if(e?.startsWith("coordinateWarning"))return;k(!1);const r=c(e??"coordinateErrorGeneric");r===e&&"coordinateErrorGeneric"!==e&&console.log(`Missing translation for error key: ${e}`),G(r||c("coordinateErrorGeneric")),H(),de()}});e.hooks.useUpdateEffect((()=>{if(!l.enableCoordinateSearch)return;if(!g.isCoordinateInput)return;const e=L,r=Y.current;if(e&&e.mapPoint&&r?.Point&&r?.SpatialReference)try{const t=e.mapPoint;if(!se(t))return console.log("Search widget: invalid stored coordinate data"),void de();const n=t.spatialReference;if(!ae(n))return console.log("Search widget: invalid spatial reference in stored coordinate"),void de();const o=new r.SpatialReference("number"==typeof n.wkid?{wkid:n.wkid}:{wkt:n.wkt}),a=new r.Point({x:t.x,y:t.y,spatialReference:o});if(!a||!Number.isFinite(a.x)||!Number.isFinite(a.y))return console.log("Search widget: failed to construct valid Point from stored data"),void de();ue(a)}catch(e){console.log("Search widget: failed to render stored coordinate",e),de()}else de()}),[l.enableCoordinateSearch,L,de,Y,ue]);const fe=e.hooks.useEventCallback((()=>{te.current=!1,H(),de(),k(!1),ne.current=""})),ge=e.hooks.useEventCallback((()=>{q.current&&Z(!1),fe()})),me=e.hooks.useEventCallback((()=>{q.current||(V(),B(!1),G(null)),Z(!0)})),ye=e.hooks.useEventCallback((()=>{I(null),ge()})),Se=e.hooks.useEventCallback((e=>{if(e){if(!Y.current)return te.current=!0,void k(!0);te.current=!1,k(!0),H(),he.searchCoordinates(e).catch((e=>{e instanceof Error&&"coordinateSearchOutdated"===e.message||e instanceof Error&&e.message||console.log("Coordinate search error:",e)}))}})),be=e.hooks.useEventCallback((e=>{const r=e??"";if(U(r),!l.enableCoordinateSearch||!r)return void ye();const t=(e=>{const r=oe(e);if(!r||r.length<5)return{isCoordinate:!1,confidence:"high",reason:"input_too_short"};if((e=>{const r=e.match(/[A-Za-z]+/g);return!!r&&r.some((e=>!/^[ENen]+$/.test(e)))})(r))return{isCoordinate:!1,confidence:"high",reason:"unsupported_characters"};const t=X(r);if(2!==t.length)return{isCoordinate:!1,confidence:t.length>2?"medium":"high",reason:"not_two_numbers"};const n=t.map(Q);if(n.some((e=>null===e)))return{isCoordinate:!1,confidence:"high",reason:"invalid_numbers"};if(le.some((e=>e.test(r))))return{isCoordinate:!1,confidence:"high",reason:"address_pattern_detected"};const[o,a]=n,s=re(o,a);return s?{isCoordinate:!0,confidence:s.warning?"medium":"high",reason:"sweref99_range"}:ee(o,a)?{isCoordinate:!0,confidence:"medium",reason:"wgs84_range"}:{isCoordinate:!1,confidence:"high",reason:"out_of_range"}})(r);I(t);t.isCoordinate&&"low"!==t.confidence?(me(),ne.current!==r&&(ne.current=r,Se(r))):ge()}));e.hooks.useUpdateEffect((()=>{if(!(l.enableCoordinateSearch&&g.isCoordinateInput&&P&&te.current))return;const e=ne.current;e?Se(e):te.current=!1}),[P,l.enableCoordinateSearch,g.isCoordinateInput,Se]);const we=Ie({mapView:m,container:S,modules:P,config:l,activeSourceIndex:g.activeSourceIndex,lastSearchTerm:g.lastSearchTerm,zoomScale:l.zoomScale,onInputChange:be,onSearchStart:e=>{q.current?B(!1):(B(!0),U(e),G(null))},onSearchComplete:e=>{if(q.current)return void B(!1);j.current=e;const r=e.map((e=>{return{sourceIndex:(r=e).sourceIndex,name:r.name,text:r.text,location:(n=r.location,n&&"function"==typeof n.toJSON?n.toJSON():null),extent:(t=r.extent,t&&"function"==typeof t.toJSON?t.toJSON():null),attributes:r.attributes?{...r.attributes}:void 0};var r,t,n}));$(r),B(!1)},onResultSelect:e=>{U(e.text||e.name)},onSearchClear:()=>{V()},onSearchError:()=>{q.current?B(!1):G(c("errorSearchFailed"))},onActiveSourceChange:e=>{J(e)}}),{activeSource:ve,hasMultiple:Ee,changeHandler:ke}=(r=>{const{sources:t,activeIndex:n,onChange:o}=r,a=e.hooks.useEventCallback((e=>{e>=0&&e<t.length&&o(e)}));return{activeSource:t[n]??null,hasMultiple:t.length>1,changeHandler:a}})({sources:l.searchSources,activeIndex:g.activeSourceIndex,onChange:e=>{J(e),we.current&&(we.current.activeSourceIndex=e),W()}}),Ce=l.enableCoordinateSearch&&g.isCoordinateInput,Me=!P||(Ce?x:g.isSearching),Te=e=>{if(!e)return c("coordinateErrorNoProjection");const r=`crs_${e.id.replace(/-/g,"_")}`,t=c(r);return t!==r?t:e.name},Ae=(r,n)=>(0,e.jsx)("div",null,(0,e.jsx)(t.Label,{css:u.coordinateLabel},c(r)),(0,e.jsx)(t.Typography,{css:u.coordinateValue},(e=>new Intl.NumberFormat(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}).format(e))(n)," m")),Oe=e.hooks.useEventCallback((e=>{const r=j.current;if(!Array.isArray(r)||0===r.length)return void console.log("Search widget: no results available");if(e<0||e>=r.length)return void console.log("Search widget: invalid result index",e);const t=r[e];if(!t)return void console.log("Search widget: missing result at index",e);const n=m?.view??we.current?.view??null,o=(a=n,Boolean(a&&"function"==typeof a.goTo)?n:null);var a;if(!o)return void console.log("Search widget: map view not available for navigation");const s=t.extent??t.location??null;s?o.goTo(s).catch((e=>{console.log("Search widget: navigation failed",e)})):console.log("Search widget: result lacks navigable geometry")})),Pe=()=>x?(0,e.jsx)("div",{css:u.coordinateLoading},(0,e.jsx)(t.Loading,null),(0,e.jsx)(t.Typography,null,c("searching"))):L?(()=>{if(!L)return null;const r=Le(L.projectionId),n=Te(r);return(0,e.jsx)("div",{css:u.coordinateDetails,role:"group"},(0,e.jsx)("div",null,(0,e.jsx)(t.Label,{css:u.coordinateLabel},c("projection")),(0,e.jsx)(t.Typography,{css:u.coordinateValue},n)),Ae("coordinateEasting",L.easting),Ae("coordinateNorthing",L.northing),L.warnings?.map(((r,o)=>(0,e.jsx)("div",{key:`${r}-${o}`,css:u.coordinateWarning,role:"note"},(0,e.jsx)(t.Typography,null,c(r,{projection:n}))))))})():null;return(0,e.jsx)("div",{"aria-live":"polite"},(0,e.jsx)("div",{css:u.container},(0,e.jsx)("div",{css:u.controls},(0,e.jsx)("div",{css:u.inputArea,"data-loading":Me},Me&&(0,e.jsx)(t.Loading,null),(0,e.jsx)("div",{ref:N,"aria-label":c("searchPlaceholder")})),(0,e.jsx)("div",{css:u.actions},Ee&&(0,e.jsx)(t.Dropdown,{isOpen:w,toggle:D,css:u.sourceSelector},(0,e.jsx)(t.DropdownButton,{"aria-label":c("selectSource")},(0,e.jsx)(t.Typography,null,ve?.name??c("selectSource")),(0,e.jsx)(t.SVG,{src:o()})),(0,e.jsx)(t.DropdownMenu,{role:"menu"},l.searchSources.map(((r,n)=>(0,e.jsx)(t.DropdownItem,{key:r.id??`source-${n}`,active:n===g.activeSourceIndex,onClick:()=>{ke(n)}},r.name)))))))),(()=>{if(!(l.enableCoordinateSearch&&l.showCoordinateBadge&&g.isCoordinateInput&&L?.projectionId))return null;const r=Le(L.projectionId),n=Te(r);return(0,e.jsx)("div",{css:u.coordinateBadge,role:"status","aria-live":"polite","aria-label":c("coordinateDetected",{projection:n})},(0,e.jsx)(t.Typography,null,n),"medium"===C?.confidence&&(0,e.jsx)(t.Typography,null,c("warningLowConfidence")))})(),g.errorMessage&&(0,e.jsx)(t.Alert,{open:!0,withIcon:!0,type:"error",text:g.errorMessage}),(()=>{if(Ce)return Pe();if(!R.length){return g.lastSearchTerm&&!g.isSearching&&!g.errorMessage?(0,e.jsx)(t.Typography,{css:u.resultStatus},c("noResultsFound")):null}return(0,e.jsx)("div",{css:u.resultsList,role:"list"},R.map(((r,n)=>(0,e.jsx)(t.Button,{key:`${r.sourceIndex}-${n}-${r.name}`,css:u.resultItem,onClick:()=>{Oe(n)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),Oe(n))},role:"listitem",type:"tertiary"},(0,e.jsx)(t.Typography,null,r.name||r.text),(0,e.jsx)(t.Typography,null,c("resultFromSource",{source:l.searchSources[r.sourceIndex]?.name??ve?.name??""}))))))})(),F&&(0,e.jsx)(t.Alert,{open:!0,withIcon:!0,type:"error",text:c("errorSearchFailed")}),d&&(0,e.jsx)(r.JimuMapViewComponent,{useMapWidgetId:d,onActiveViewChange:_}))};function Ae(e){s.p=e}})(),i})())}}}));